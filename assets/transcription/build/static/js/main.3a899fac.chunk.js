(this.webpackJsonptranscription=this.webpackJsonptranscription||[]).push([[0],{110:function(e,t,n){},153:function(e,t,n){"use strict";n.r(t);var r,i=n(1),c=n(0),a=n.n(c),o=n(15),s=n.n(o),l=(n(110),n(6)),u=n(30),d=n(213),j=n(195),b=n(214),h=n(215),p=n(225),f=n(198),O=n(211),x=n(212),g=n(7),m=n(190),v=function(e){return(t=Math.floor(e))<10?"0".concat(t<0?0:t):t.toString();var t},y=function(e){return"".concat(v(e/3600),":").concat(v(e/60),":").concat(v(e%60),":").concat(v(Math.round(100*(e-Math.floor(e)))))},k=function(e){return e>3600?y(e).substring(0,8):y(e).substring(3,8)},C=function(e){return e.length>0?e[e.length-1].endtimestamp:"00:00:00:00"},w=function(e){return e.length>0?e[e.length-1].endtimeseconds:0},S=function(e,t){for(var n=0;n<e.length;n++)if(t>e[n].starttimeseconds&&t<e[n].endtimeseconds)return e[n]},T=function(e){return e.transcriptions.reduce((function(e,t){return e||""!==t.content}),!1)},M=function(e){return{hours:Number(e.slice(0,2)),minutes:Number(e.slice(3,5)),seconds:Number(e.slice(6,8)),milliseconds:Number(e.slice(9,11))}},N=function(e){return 60*e.hours*60+60*e.minutes+e.seconds},R=function(e){return e.name?e.name:"".concat(N(M(e.endtimestamp))-N(M(e.starttimestamp))," second chunk")},B=n(185),P=n(188),D=n(155),F=n(189),W=function(e){var t=e.title,n=e.children,r=e.contentStyle,c=e.cardStyle;return Object(i.jsx)(B.a,{variant:"outlined",style:Object(g.a)({},c),children:Object(i.jsxs)(P.a,{style:Object(g.a)({},r),children:[Object(i.jsx)(D.a,{variant:"h5",component:"h2",children:t}),t?Object(i.jsx)(F.a,{style:{margin:"16px 0 16px 0"}}):null,n]})})},I=Object(m.a)({titleContainer:{fontSize:"1.2rem",position:"relative"}}),E=function(e){var t=e.chunk,n=e.children,r=e.style,c=e.transcriptionIcon,a=I(),o=function(e){return{start:M(e.starttimestamp),end:M(e.endtimestamp)}}(t),s=N(o.end),l=N(o.start);return Object(i.jsx)(W,{title:Object(i.jsx)("div",{children:Object(i.jsxs)("span",{className:a.titleContainer,style:{display:"flex",flexDirection:"column"},children:[Object(i.jsxs)("span",{style:{fontWeight:600,overflowWrap:"anywhere",display:"flex",justifyContent:"space-between"},children:[R(t),c]}),"".concat(k(l)," - ").concat(k(s))]})}),cardStyle:Object(g.a)(Object(g.a)({},r),{},{position:"relative",margin:"8px"}),children:n})},A=Object(m.a)({videoPlayerContainer:{margin:"auto"},actionButton:{"&:hover":{background:"#d9534f"}},chunksList:{flexWrap:"nowrap"},backButton:{background:"transparent",color:"black",fontSize:"16px"},backButtonContainer:{marginTop:"4px"},onboardingTitle:{margin:0},chunkCardBody:{marginTop:"8px",position:"relative"},newChunkButtonContainer:{position:"absolute",right:0,bottom:0,margin:"16px 16px 32px 16px",display:"flex"}}),V=function(e){var t=Object(c.useState)(e),n=Object(l.a)(t,2),r=n[0],i=n[1];return[r,function(){return i((function(e){return!e}))},i]},L=function(e,t){var n,r=Object(c.useState)(null!==(n=window.localStorage.getItem(e))&&void 0!==n?n:t),i=Object(l.a)(r,2),a=i[0],o=i[1],s=V(!1),u=Object(l.a)(s,2),d=u[0],j=u[1];if(!d){var b=window.localStorage.getItem(e);j(),b&&o(b)}return[a,Object(c.useCallback)((function(t){"string"==typeof t||null===t?(o(t),window.localStorage.setItem(e,null!==t&&void 0!==t?t:"")):t&&o((function(n){var r=t(n);return window.localStorage.setItem(e,null!==r&&void 0!==r?r:""),r}))}),[e]),Object(c.useCallback)((function(){window.localStorage.removeItem(e),o(void 0)}),[o,e])]},z={userName:void 0,setName:function(){return null},clearName:function(){return null}},U=Object(c.createContext)(z),Y=function(e){var t=e.children,n=L("name"),r=Object(l.a)(n,3),a=r[0],o=r[1],s=r[2],u=Object(c.useMemo)((function(){return{userName:a,setName:o,clearName:s}}),[a,o,s]);return Object(i.jsx)(U.Provider,{value:u,children:t})},_=n(192),H=n(193),J=n(194),q=n(196),G=n(57),X=n.n(G),K=function(e,t){var n=Object(c.useState)(t);return null!==e&&void 0!==e?e:n},Q=n(233),Z=Object(m.a)({progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:6},progressBarRail:{height:6},progressBarTrack:{height:6},progressBarThumb:{height:18,width:18,marginTop:-6},progressBarMark:{height:14,marginTop:-3},markedSlider:{margin:0}}),$=function(e){var t=e.styles,n=Object(u.a)(e,["styles"]),r=Z();return Object(i.jsx)("div",{style:t,children:Object(i.jsx)(Q.a,Object(g.a)({classes:{colorPrimary:r.progressBarColor,root:r.progressBarRoot,rail:r.progressBarRail,track:r.progressBarTrack,thumb:r.progressBarThumb,mark:r.progressBarMark,marked:r.markedSlider}},n))})},ee=n(85),te=function(e,t,n,r,i,a,o){var s=Object(l.a)(t,2),u=s[0],d=s[1],j=Object(c.useState)(!1),b=Object(l.a)(j,2),h=b[0],p=b[1],f=Object(c.useState)(!1),O=Object(l.a)(f,2),x=O[0],g=O[1],m=e.progress,v=e.setProgress,y=e.setProgressWithVideoUpdate;Object(c.useEffect)((function(){h&&n.current&&r(n.current.getDuration())}),[r,n,h]);var k=Object(c.useMemo)((function(){return{playing:!x&&u,progressInterval:100,onProgress:function(e){var t=e.played;return v(t)},onReady:function(){return p(!0)},onEnded:function(){return d(!1)}}}),[x,u,d,v]),C=Object(ee.a)((function(e){return y(e/100)}),10),w=function(e,t){var n=Object(c.useState)(e),r=Object(l.a)(n,2),i=r[0],a=r[1],o=Object(c.useCallback)((function(e){a(e),t(e)}),[a,t]);return{value:i,setWithoutVideoUpdate:a,setWithVideoUpdate:o}}(100*m,C),S=w.value,T=w.setWithVideoUpdate,M=w.setWithoutVideoUpdate;Object(c.useEffect)((function(){M(100*m)}),[m,M]);var N=Object(c.useMemo)((function(){return{value:S,min:100*i.start,max:100*i.end,step:1e-4,onChange:function(e,t){a&&a(),g(!0),T(t)},onChangeCommitted:function(e,t){g(!1)}}}),[S,i,a,T,y]);return Object(c.useEffect)((function(){m>i.end+1e-4?o&&!x?y(i.start):(y(i.end),d(!1)):m<i.start-1e-4&&y(i.start+.1)}),[m,u,d,i.end,i.start,o,y,x]),{playerProps:k,progressBarProps:N,showControls:!0,isPlaying:u,toggleIsPlaying:function(){return d((function(e){return!e}))}}},ne=n(232),re=function(e){var t=e.children,n=e.open,r=e.value;return Object(i.jsx)(ne.a,{open:n,enterTouchDelay:0,placement:"top",title:r,children:t})},ie=Object(m.a)({videoControlsContainer:{display:"flex",left:"50%",position:"absolute",bottom:"50%",transform:"translate(-50%, 50%)"},videoPlayerButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #f54414 90%)"},roundButton:{borderRadius:"50px",width:"64px",height:"64px",color:"white",display:"relative",top:"4px"},videoPlayerContainer:{position:"relative",bottom:0,top:0,right:0,left:0},progressBarContainer:{left:"0",bottom:"0",marginBottom:"-39px",transform:"translateY(calc(-100% - 16px))"},progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:4},progressBarRail:{height:4},progressBarTrack:{height:4},progressBarThumb:{height:12,marginTop:-4},progressBarMark:{height:10,marginTop:-3}}),ce=function(e){var t=e.url,n=e.playerRef,r=e.controller,a=e.sliderMarks,o=e.progressState,s=e.onProgressDrag,u=e.slider,d=e.loop,b=ie(),h=K(null===r||void 0===r?void 0:r.durationState,0),f=Object(l.a)(h,2),O=f[0],x=f[1],m=o.progress,v=o.setProgressWithVideoUpdate,y=K(null===r||void 0===r?void 0:r.playingState,!1),C=K(null===r||void 0===r?void 0:r.splitState,{start:0,end:1}),w=Object(l.a)(C,1)[0],S=te(o,y,n,x,w,s,d),T=S.playerProps,M=S.progressBarProps,N=S.showControls,R=S.isPlaying,B=S.toggleIsPlaying,P=Object(c.useCallback)((function(e){return k((e/100-w.start===0?0:e/100-w.start)*O)}),[O,w.start]),F=Object(c.useCallback)((function(){O&&v((function(e){return e+5/O}))}),[v,O]),W=Object(c.useCallback)((function(){O&&v((function(e){return e-5/O}))}),[v,O]);return Object(i.jsxs)(p.a,{className:b.videoPlayerContainer,children:[Object(i.jsx)(X.a,Object(g.a)({url:t,ref:n,width:"100%",height:"100%",loop:d},T)),N&&Object(i.jsxs)("div",{className:b.videoControlsContainer,children:[Object(i.jsx)("div",{style:{position:"absolute",right:"240px",bottom:-4},children:Object(i.jsx)(_.a,{disableRipple:!0,className:"".concat(b.videoPlayerButton," ").concat(b.roundButton),onClick:W,children:Object(i.jsx)(H.a,{fontSize:"large"})})}),Object(i.jsx)(_.a,{disableRipple:!0,variant:"contained",color:"primary",className:b.videoPlayerButton,onClick:B,children:R&&Object(i.jsx)(J.a,{fontSize:"large"})||Object(i.jsx)(j.a,{fontSize:"large"})}),Object(i.jsx)("div",{style:{position:"absolute",left:"240px",bottom:-4},children:Object(i.jsx)(_.a,{onClick:F,disableRipple:!0,className:"".concat(b.videoPlayerButton," ").concat(b.roundButton),children:Object(i.jsx)(q.a,{fontSize:"large"})})})]}),u||Object(i.jsxs)("div",{className:b.progressBarContainer,children:[Object(i.jsx)(D.a,{variant:"caption",style:{margin:"8px",color:"#FFFFFF"},children:O&&"".concat(k((m-w.start)*O)," / ").concat(k((w.end-w.start)*O))}),Object(i.jsx)($,Object(g.a)({valueLabelDisplay:"auto",valueLabelFormat:P,ValueLabelComponent:re,marks:a||[]},M))]})]})},ae=function(e){var t=Object(c.useRef)(null),n=Object(c.useCallback)((function(e){var n,r,i=null===t||void 0===t||null===(n=t.current)||void 0===n?void 0:n.getSecondsLoaded();i&&i>0&&(null===(r=t.current)||void 0===r||r.seekTo(e,"fraction"))}),[]),r=Object(c.useState)(0),i=Object(l.a)(r,2),a=i[0],o=i[1],s=Object(c.useState)({start:0,end:1}),u=Object(c.useCallback)((function(e){"number"===typeof e?(o(e),n(e)):o((function(t){var r=e(t);return n(r),r}))}),[n]),d=Object(c.useState)(0),j=Object(l.a)(d,2),b=j[0],h=j[1],p=Object(c.useState)(null!==e&&void 0!==e&&e);return{progressState:{progress:a,setProgress:o,setProgressWithVideoUpdate:u},splitState:s,playingState:p,duration:b,controller:{durationState:[b,h],playingState:p,splitState:s},playerRef:t}},oe=n(228),se=function(e,t){return e.reduce((function(e,t,n,r){return n+1<r.length?e.concat([[t,r[n+1]]]):e}),[]).map((function(e){return t(e[0],e[1])}))},le=function(e,t){return e.filter(t).length>0},ue=Object(c.createContext)([[],function(){return null}]),de={ChunksProvider:function(e){var t=e.state,n=e.children;return Object(i.jsx)(ue.Provider,{value:t,children:n})},useChunksState:function(){return Object(c.useContext)(ue)}},je=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1],n=Object(c.useCallback)(t,[]);return Object(c.useCallback)((function(e,t,r){n((function(n){return n.map((function(n){var i,c;return n.id===e.id?Object(g.a)(Object(g.a)({},(null===(i=n.review)||void 0===i?void 0:i.selectedtranscription)===(null===(c=function(e,t){return e.transcriptions.filter((function(e){return e.creatorid===t}))[0]}(n,r))||void 0===c?void 0:c.id)&&""===t?function(e){return Object(g.a)(Object(g.a)({},e),{},{review:void 0})}(n):n),{},{transcriptions:le(n.transcriptions,(function(e){return e.creatorid===r}))?""===t?n.transcriptions.filter((function(e){return e.creatorid!==r})):n.transcriptions.map((function(e){return e.creatorid===r?Object(g.a)(Object(g.a)({},e),{},{content:t}):e})):n.transcriptions.concat(""===t?[]:[{creatorid:r,content:t,id:Object(oe.a)(),updatedat:new Date}])}):n}))}))}),[n])},be=function(e,t){return""!==e?Object(g.a)(Object(g.a)({},t),{},{name:e}):Object(g.a)(Object(g.a)({},t),{},{name:void 0})},he=Object(m.a)({button:function(e){return{backgroundColor:"#d9534f",color:"#FFFFFF",lineHeight:"34px",height:"60px",borderRadius:e?"50%":"6px",padding:e?"4px":"3px 8px 3px 8px",textTransform:"none","&:hover":{backgroundColor:"#ff7570"},"&:disabled":{backgroundColor:"#fabbb9"}}}}),pe=function(e){var t=e.children,n=e.round,r=e.styles,c=Object(u.a)(e,["children","round","styles"]),a=function(e){return Object(m.a)({overrideStyles:Object(g.a)({},e)})}(r)(),o=he(!!n);return Object(i.jsx)(_.a,Object(g.a)(Object(g.a)({disableRipple:!0,className:"".concat(o.button," ").concat(a.overrideStyles)},c),{},{children:t}))},fe=n(226),Oe=n(229),xe=n(197),ge=n(199),me=n(91),ve=a.a.forwardRef((function(e,t){var n=e.children,r=e.style;return Object(i.jsx)(me.a,{ref:t,elevation:0,style:r,children:n})})),ye=Object(m.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"}}),ke=function(e){var t=e.children,n=e.header,r=e.exit,c=Object(u.a)(e,["children","header","exit"]),a=ye();return Object(i.jsx)(Oe.a,Object(g.a)(Object(g.a)({className:a.modal},c),{},{children:Object(i.jsx)(xe.a,{style:{outline:"none"},children:Object(i.jsxs)(ve,{children:[n&&Object(i.jsxs)(f.a,{children:[Object(i.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"8px"},children:[Object(i.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignContent:"center"},children:n}),Object(i.jsx)(pe,{onClick:r,children:Object(i.jsx)(ge.a,{})})]}),Object(i.jsx)(F.a,{style:{margin:"12px 0px 12px 0px"}})]}),Object(i.jsx)("div",{className:a.modalContentBox,children:t})]})})}))},Ce="localhost",we=function(e){var t=1===e["data-index"];return Object(i.jsx)("span",Object(g.a)(Object(g.a)({},e),{},{style:Object(g.a)(Object(g.a)({},e.style),{},{transform:t?"0":"translateY(14px)",backgroundColor:t?"#d9534f":"#f77965"}),children:t?null:Object(i.jsx)("div",{style:{height:"14px",width:"4px",transform:"translateY(-9px)",backgroundColor:"#f77965"}})}))},Se=function(e){var t=e.story_id,n=e.chunk,r=e.storyDuration,a=e.croppedSplitState,o=ae(),s=o.progressState,u=o.controller,d=o.playerRef,j=Object(c.useState)([0,0]),b=Object(l.a)(j,2),h=b[0],p=b[1],O=Object(l.a)(a,2),x=O[0],g=O[1],m=s.setProgressWithVideoUpdate;return Object(c.useEffect)((function(){m(n.starttimeseconds);var e=n.starttimeseconds-2/r,t=n.endtimeseconds+2/r;p([e<0?0:e,t>1?1:t]),g([n.starttimeseconds,n.endtimeseconds])}),[n.starttimeseconds,n.endtimeseconds,r,m,g]),Object(i.jsxs)("div",{children:[Object(i.jsx)(f.a,{children:Object(i.jsx)("h2",{style:{margin:0},children:"Cropping:"})}),Object(i.jsx)(ce,{progressState:s,url:"http://".concat(Ce,":8845/api/watch/getvideo/").concat(t),controller:u,playerRef:d,slider:Object(i.jsx)($,{value:[100*x[0],100*s.progress,100*x[1]],min:100*h[0],max:100*h[1],step:1e-4,ThumbComponent:we,onChange:function(e,t){g([t[0]/100,t[2]/100]),s.setProgressWithVideoUpdate(t[1]/100)}})})]})},Te=function(e){var t=Object(l.a)(e.nameState,2),n=t[0],r=t[1];return Object(i.jsx)(fe.a,{variant:"outlined",label:"Edit Name",style:{marginTop:"8px"},value:n,onChange:function(e){return r(e.target.value)}})},Me=function(e){var t=e.story_id,n=e.chunk,r=e.exit,a=e.storyDuration,o=Object(c.useState)(""),s=Object(l.a)(o,2),u=s[0],d=s[1];Object(c.useEffect)((function(){n&&d(n.name?n.name:"")}),[n]);var j=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1];return function(e,n,r,i,c){t((function(t){var a,o,s=(a=e,(o=t).reduce((function(e,t,n){return t.id===a.id?{prev:o[n-1],next:o[n+1]}:e}),{prev:void 0,next:void 0}));return function(e){return e.filter((function(e){return e.endtimeseconds>e.starttimeseconds}))}(t.map((function(t){var i,a;return t.id===e.id?Object(g.a)(Object(g.a)({},c?be(c,t):Object(g.a)(Object(g.a)({},t),{},{name:void 0})),{},{starttimeseconds:r[0],starttimestamp:y(r[0]*n),endtimeseconds:r[1],endtimestamp:y(r[1]*n),updatedat:new Date}):t.id===(null===(i=s.next)||void 0===i?void 0:i.id)?Object(g.a)(Object(g.a)({},t),{},{starttimeseconds:r[1],starttimestamp:y(r[1]*n),updatedat:new Date}):t.id===(null===(a=s.prev)||void 0===a?void 0:a.id)?Object(g.a)(Object(g.a)({},t),{},{endtimeseconds:r[0],endtimestamp:y(r[0]*n),updatedat:new Date}):t})).concat(s.prev||0===r[0]?[]:[{starttimestamp:y(0),starttimeseconds:0,endtimestamp:y(r[0]*n),endtimeseconds:r[0],creatorid:i,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}))}))}}(),b=Object(c.useState)([0,0]),h=Object(l.a)(b,2),p=h[0],f=h[1],O=Object(c.useContext)(U).userName;return Object(i.jsx)(ke,{exit:function(){n&&O&&j(n,a,p,O,u),r()},open:void 0!==n,header:Object(i.jsx)(Te,{nameState:[u,d]}),children:Object(i.jsx)("div",{style:{paddingBottom:"24px"},children:n&&Object(i.jsx)(Se,{story_id:t,croppedSplitState:[p,f],storyDuration:a,chunk:n})})})},Ne=function(e){var t=e.url,n=e.time,r=Object(c.useRef)(null);return Object(i.jsx)(X.a,{crossOrigin:"anonymous",url:t,width:"100%",height:"100%",playing:!1,ref:r,id:"video-thumbnail-player",onReady:function(){var e;null===(e=r.current)||void 0===e||e.seekTo(n,"fraction")}})},Re=n(66),Be=n(201),Pe=Object(m.a)({backButton:{}}),De=function(e){var t=e.action,n=Pe();return Object(i.jsxs)(Re.a,{className:n.backButton,onClick:t,children:[Object(i.jsx)(Be.a,{fontSize:"large"}),Object(i.jsx)(D.a,{variant:"h5",style:{position:"relative",left:-5},children:"Back"})]})},Fe=n(61);!function(e){e[e.True=0]="True"}(r||(r={}));var We=function(e,t){var n=Object(c.useState)(r.True),i=Object(l.a)(n,2),a=i[0],o=i[1],s=Object(c.useCallback)((function(){a!==r.True&&(e.apply(void 0,Object(Fe.a)(a)),o(r.True))}),[a,e]);return{attemptingActionWith:a,cancelAction:function(){return o(r.True)},attemptAction:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.apply(void 0,r)?o(r):e.apply(void 0,r)},confirmAction:s}},Ie=n(203),Ee=n(202),Ae=function(e){var t=e.message;return Object(i.jsx)("h2",{style:{margin:0},children:Object(i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(i.jsx)(Ee.a,{style:{marginRight:"8px"},fontSize:"large"}),t]})})},Ve=function(e){var t=e.actionControls,n=e.warningMessage,c=e.children,a=t.attemptingActionWith,o=t.cancelAction,s=t.confirmAction;return Object(i.jsx)(ke,{open:a!==r.True,exit:o,header:Object(i.jsx)(Ae,{message:n}),children:Object(i.jsxs)("div",{children:[a!==r.True&&c.apply(void 0,Object(Fe.a)(a)),Object(i.jsx)("br",{}),Object(i.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(i.jsxs)(pe,{style:{marginTop:"8px"},onClick:s,children:[Object(i.jsx)(Ie.a,{fontSize:"large",style:{marginRight:"8px"}}),Object(i.jsx)(D.a,{variant:"subtitle1",children:"Confirm"})]})})]})})},Le=function(e){var t=e.chunk,n=e.exit;return Object(i.jsx)(ke,{open:void 0!==t,header:Object(i.jsx)("h2",{style:{margin:0,overflowWrap:"anywhere"},children:'Transcriptions for "'.concat(t&&R(t),'"')}),exit:n,children:Object(i.jsx)("div",{style:{overflow:"scroll"},children:null===t||void 0===t?void 0:t.transcriptions.map((function(e){return Object(i.jsx)(W,{title:Object(i.jsx)("b",{children:e.creatorid}),contentStyle:{whiteSpace:"pre"},children:e.content},e.id)}))})})},ze=function(e){var t=e.children,n=e.style,r=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}),[]),Object(i.jsx)("div",{ref:r,style:Object(g.a)({},n),children:t})},Ue=n(205),Ye=n(206),_e=n(207),He=n(90),Je=n(204),qe=a.a.forwardRef((function(e,t){var n=e.anchor,r=e.show,c=e.menuItems;return Object(i.jsx)(He.a,{ref:t,anchorEl:n,open:r,children:c.map((function(e,t){return Object(i.jsx)(Je.a,{onClick:e.handler,children:e.content},t)}))})})),Ge=function(e){var t=e.menuItems,n=Object(c.useState)(!1),r=Object(l.a)(n,2),a=r[0],o=r[1],s=Object(c.useRef)(null);return Object(i.jsxs)("div",{style:{position:"relative",top:0,right:0,display:"flex",flexDirection:"row",alignSelf:"flex-start"},children:[Object(i.jsx)(Ue.a,{onClickAway:function(){return o(!1)},children:Object(i.jsx)(Ye.a,{style:{padding:0},onClick:function(){return o(!0)},ref:s,children:Object(i.jsx)(_e.a,{})})}),Object(i.jsx)(qe,{show:a,anchor:s.current,menuItems:t})]})},Xe=n(208),Ke=Object(m.a)({loadingModal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"}}),Qe=function(e){var t=e.open,n=Ke();return Object(i.jsx)(Oe.a,{open:t,className:n.loadingModal,children:Object(i.jsx)(xe.a,{style:{outline:"none",display:"flex",justifyContent:"center"},children:Object(i.jsx)(Xe.a,{})})})},Ze=n(235),$e=n(209),et=n(231),tt=n(210),nt=function(e){var t=Object(c.useState)([0,null]),n=Object(l.a)(t,2),r=Object(l.a)(n[0],2),i=r[0],a=r[1],o=n[1],s=Object(c.useCallback)((function(){o([0,null])}),[o]),u=Object(c.useMemo)((function(){return i===e.length-1}),[i,e.length]);return{page:i,direction:a,goTo:function(t){return"next"===t&&i<e.length-1?o((function(e){return[Object(l.a)(e,1)[0]+1,"next"]})):"prev"===t&&i>0?o((function(e){return[Object(l.a)(e,1)[0]-1,"prev"]})):null},reset:s,lastPage:u}},rt=Object(m.a)({contentContainer:{paddingBottom:"32px",height:"40vh",display:"flex",flexDirection:"column"},instructionsContainer:{flexGrow:4},divider:{marginBottom:"16px"},centerVertically:{position:"relative",top:"50%",transform:"translateY(-50%)"},buttonsContainer:{display:"flex",justifyContent:"space-between"}}),it=function(e){var t=e.show,n=e.dismiss,r=e.title,a=e.steps,o=e.startButtonContent,s=nt(a),l=s.page,u=s.goTo,d=s.reset,j=Object(c.useCallback)((function(){d(),n()}),[]),b=Object(c.useCallback)((function(){l===a.length-1?j():u("next")}),[l,u,j,a.length]),h=Object(c.useCallback)((function(){u("prev")}),[u]),p=rt();return Object(i.jsx)(ke,{header:r,open:t,exit:j,children:Object(i.jsxs)("div",{className:p.contentContainer,children:[Object(i.jsx)(Ze.a,{activeStep:l,children:a.map((function(e,t){return Object(i.jsx)($e.a,{children:Object(i.jsx)(et.a,{})},t)}))}),Object(i.jsxs)(f.a,{className:p.instructionsContainer,children:[Object(i.jsx)(F.a,{className:p.divider}),Object(i.jsx)("div",{className:p.centerVertically,children:Object(i.jsx)(D.a,{variant:"h5",children:a[l]})})]}),Object(i.jsxs)(f.a,{className:p.buttonsContainer,children:[0===l?Object(i.jsx)("div",{}):Object(i.jsxs)(Re.a,{onClick:h,children:[Object(i.jsx)(Be.a,{})," Previous"]}),Object(i.jsx)(Re.a,{onClick:b,children:l===a.length-1?o:Object(i.jsxs)(i.Fragment,{children:["Next ",Object(i.jsx)(tt.a,{})]})})]})]})})},ct=function(e){var t=e.atExit,n=e.story_id,r=e.onboarding,a=de.useChunksState(),o=Object(l.a)(a,2),s=o[0],m=o[1];Object(c.useEffect)((function(){m((function(e){return e}))}),[m]);var v=ae(),k=v.progressState,M=v.playingState,N=v.duration,B=v.controller,P=v.playerRef,D=k.progress,F=k.setProgressWithVideoUpdate,I=Object(l.a)(M,2)[1],V=Object(c.useMemo)((function(){return function(e){return e.map((function(e){return{value:100*e.endtimeseconds}}))}(s)}),[s]),L=Object(c.useContext)(U).userName,z=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1];return function(e){t((function(t){return e(t),t}))}}(),Y=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1];return function(e){return t((function(t){return se(t.filter((function(t){return t.id!==e.id})),(function(e,t){return e.endtimeseconds!==t.starttimeseconds?Object(g.a)(Object(g.a)({},t),{},{starttimeseconds:e.endtimeseconds,starttimestamp:e.endtimestamp,id:Object(oe.a)(),updatedat:new Date,transcriptions:[]}):t})).concat((n=t.filter((function(t){return t.id!==e.id}))[0],n?0===n.starttimeseconds?[n]:[Object(g.a)(Object(g.a)({},n),{},{starttimeseconds:0,starttimestamp:"00:00:00:00",id:Object(oe.a)(),updatedat:new Date,transcriptions:[]})]:[])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}));var n}))}}(),_=function(){var e=de.useChunksState(),t=Object(l.a)(e,2),n=t[0],r=t[1];return function(e,t,i){if(!function(e,t,n){return 0===t||t>n||e.reduce((function(e,n){return e||n.endtimeseconds===t||n.starttimeseconds===t}),!1)}(n,e,t)){var c=S(n,e);r(void 0!==c?function(n){return n.filter((function(e){return e.id!==c.id})).concat([{starttimestamp:c.starttimestamp,starttimeseconds:c.starttimeseconds,endtimestamp:y(e*t),endtimeseconds:e,creatorid:i,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]},{starttimestamp:y(e*t),starttimeseconds:e,endtimestamp:c.endtimestamp,endtimeseconds:c.endtimeseconds,creatorid:i,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}]).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}))}:function(n){return n.concat([{starttimestamp:C(n),endtimestamp:y(e*t),starttimeseconds:w(n),endtimeseconds:e,creatorid:i,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}])})}}}(),H=A(),J=Object(c.useState)(void 0),q=Object(l.a)(J,2),G=q[0],X=q[1];Object(c.useEffect)((function(){void 0!==G&&D>G.endtimeseconds&&(X(void 0),I(!1))}),[D,G,s,I]);var K=Object(c.useCallback)((function(e,t,n){(null===t||void 0===t?void 0:t.id)===e.id&&n?I(!1):(I(!0),X(e),F(e.starttimeseconds))}),[F,I]),Q=Object(c.useState)(void 0),Z=Object(l.a)(Q,2),$=Z[0],ee=Z[1],te=We((function(e,t,n,r){return _(t,n,r)}),(function(e,t){var n=S(e,t);return void 0!==n&&T(n)})),ne=te.attemptAction,re=Object(u.a)(te,["attemptAction"]),ie=We(Y,(function(e){return T(e)})),le=ie.attemptAction,ue=Object(u.a)(ie,["attemptAction"]),je=Object(c.useState)(void 0),be=Object(l.a)(je,2),he=be[0],fe=be[1],Oe=Object(c.useMemo)((function(){return{marginRight:"4px",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.8}}),[]),xe=Object(c.useRef)({backgroundColor:"green",height:"100%",padding:"16px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",color:"white"}),ge=Object(c.useRef)({margin:"8px",transform:"translateY(8px)",height:"calc(100% - 16px)"}),me=r.showOnboardingModal,ve=r.dismissOnboardingModal,ye=Object(c.useCallback)((function(){return X(void 0)}),[X]);return Object(i.jsxs)(p.a,{children:[Object(i.jsx)(Qe,{open:0===N}),Object(i.jsx)(f.a,{children:Object(i.jsx)("div",{className:H.backButtonContainer,children:Object(i.jsx)(De,{action:t})})}),Object(i.jsx)(it,{show:me,dismiss:ve,title:Object(i.jsx)("h2",{className:H.onboardingTitle,children:"Chunking Instructions"}),steps:["You are about to chunk the video. The aim of chunking is to make Transcribing easy.","Rather than transcribing the entire video at once, you will break the video down into smaller chunks, which you will transcribe individually.","You should aim to have only one person speaking in each chunk. Create a new chunk when there is a change in who is talking, there is a gap in the talking, or a person begins/ends talking.","To create a chunk, press the '+' button in the bottom right corner. The time that you press the '+' button in the video will be the end of the new chunk."],startButtonContent:Object(i.jsx)("div",{children:"Start Chunking"})}),Object(i.jsx)(Me,{story_id:n,chunk:$,exit:function(){return ee(void 0)},storyDuration:N}),Object(i.jsx)(Ve,{actionControls:ue,warningMessage:Object(i.jsx)("div",{children:"This Chunk has a transcription"}),children:function(){return Object(i.jsxs)("div",{style:{overflowWrap:"anywhere"},children:["Attempting to delete chunk",(arguments.length<=0?void 0:arguments[0])&&' "'.concat(R(arguments.length<=0?void 0:arguments[0]),'"'),", which has a transcription saved to it. Are you sure you want to delete it?"]})}}),Object(i.jsx)(Ve,{actionControls:re,warningMessage:Object(i.jsx)("div",{children:"The enclosing chunk has a transcription"}),children:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Object(i.jsxs)("div",{children:['Creating a new chunk here will delete the transcriptions on the enclosing chunk, "',R(null!==(e=S(n[0],n[1]))&&void 0!==e?e:n[0][0]),'". Are you sure you want to discard these transcriptions?']})}}),Object(i.jsx)(Le,{chunk:he,exit:function(){return fe(void 0)}}),Object(i.jsx)("div",{className:H.videoPlayerContainer,children:Object(i.jsx)(ce,{controller:B,progressState:k,playerRef:P,url:"http://".concat(Ce,":8845/api/watch/getvideo/").concat(n),sliderMarks:V,onProgressDrag:ye})}),Object(i.jsx)(O.a,{className:H.chunksList,cellHeight:"auto",cols:2.5,children:s.map((function(e){return Object(i.jsx)(x.a,{children:Object(i.jsx)(ze,{children:Object(i.jsx)(E,{chunk:e,transcriptionIcon:Object(i.jsx)(Ge,{menuItems:[{content:"Delete",handler:function(){return function(e){z((function(t){t.forEach((function(t){return t.id===e.id&&le(t)}))}))}(e)}},{content:"Edit",handler:function(){return ee(e)}}].concat(0!==e.transcriptions.length?[{content:"View Transcriptions",handler:function(){return fe(e)}}]:[])}),children:Object(i.jsxs)("div",{className:H.chunkCardBody,children:[Object(i.jsx)(Ne,{url:"http://".concat(Ce,":8845/api/watch/getvideo/").concat(n),time:e.starttimeseconds+(e.endtimeseconds-e.starttimeseconds)/2}),Object(i.jsx)(pe,{round:!0,color:"primary",style:Oe,onClick:function(){return K(e,G,M[0])},children:(null===G||void 0===G?void 0:G.id)===e.id&&M[0]?Object(i.jsx)(d.a,{}):Object(i.jsx)(j.a,{})})]})})})},e.id)})).concat(w(s)>.75?[Object(i.jsx)(x.a,{onClick:function(){1!==w(s)&&L&&_(1,N,L),t()},children:Object(i.jsx)(ze,{style:{height:"100%"},children:Object(i.jsx)(W,{contentStyle:xe.current,cardStyle:ge.current,children:Object(i.jsx)(b.a,{fontSize:"large",style:{marginRight:"4px"}})})})},"Done Card")]:[])}),Object(i.jsx)("div",{children:Object(i.jsx)("div",{className:H.newChunkButtonContainer,children:Object(i.jsx)(pe,{round:!0,"aria-label":"New Chunk",style:{margin:"8px"},onClick:function(){L&&ne(s,D,N,L)},children:Object(i.jsx)(h.a,{})})})})]})},at=n(157);var ot,st=function(e){return Object(i.jsxs)(p.a,{display:"flex",alignItems:"center",children:[Object(i.jsx)(p.a,{width:"100%",mr:1,children:Object(i.jsx)(at.a,Object(g.a)({variant:"determinate"},e))}),Object(i.jsx)(p.a,{minWidth:35,children:Object(i.jsx)(D.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},lt="#dddddd",ut=Object(m.a)({paper:{border:"1px solid ".concat(lt),borderTop:"0",borderTopRightRadius:"0",borderTopLeftRadius:"0",padding:"15px"},stepHeader:{padding:"4px",backgroundColor:"#f5f5f5",border:"1px solid ".concat(lt),borderBottomRightRadius:"0",borderBottomLeftRadius:"0"},button:{marginTop:"16px"}}),dt=function(e){var t=e.title,n=e.description,r=e.progress,c=e.onSelect,a=e.enabled,o=ut();return Object(i.jsxs)("div",{children:[Object(i.jsx)(ve,{children:Object(i.jsxs)("div",{className:o.stepHeader,children:[Object(i.jsx)(D.a,{variant:"subtitle1",children:t}),Object(i.jsx)(st,{value:r})]})}),Object(i.jsx)(ve,{children:Object(i.jsxs)("div",{className:o.paper,children:[n,Object(i.jsx)("br",{}),Object(i.jsx)(p.a,{style:{marginTop:"8px"},children:Object(i.jsx)(pe,{disabled:!a,onClick:c,children:Object(i.jsxs)(D.a,{style:{padding:"6px"},children:["Perform ",t]})})})]})})]})},jt=Object(m.a)({introContainer:{textAlign:"center"},transcriberModal:{display:"flex",flexDirection:"column"}}),bt=n(234),ht=a.a.forwardRef((function(e,t){var n=e.placeholder,r=e.buttonText,a=e.classes,o=e.onSubmit,s=Object(c.useState)(null),u=Object(l.a)(s,2),d=u[0],j=u[1];return Object(i.jsxs)("div",{ref:t,children:[Object(i.jsx)(bt.a,{className:a.input,onChange:function(e){return j(e.target.value)},placeholder:n}),Object(i.jsx)(pe,{onClick:function(){return d&&o(d)},styles:{height:"3rem",borderRadius:"0px 8px 8px 0px"},children:Object(i.jsx)(D.a,{variant:"subtitle1",children:r})})]})})),pt=Object(m.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"},input:{flex:1,width:"400px",height:"3rem",border:"1px solid #cccccc",paddingLeft:"8px",borderRadius:"8px 0px 0px 8px"}}),ft=function(e){var t=e.show,n=e.setName,r=pt();return Object(i.jsx)(ke,{open:t,children:Object(i.jsxs)("div",{children:[Object(i.jsx)(D.a,{variant:"subtitle1",children:"Please enter your name before performing transcription:"}),Object(i.jsx)(ht,{placeholder:"my name",buttonText:"Perform Transcription",classes:r,onSubmit:n})]})})},Ot=n(216),xt=Object(m.a)({indabaLink:{color:"#d9534f",cursor:"pointer"}}),gt=a.a.forwardRef((function(e,t){var n=e.children,r=Object(u.a)(e,["children"]),c=xt();return Object(i.jsx)(Ot.a,Object(g.a)(Object(g.a)({ref:t,className:c.indabaLink},r),{},{children:n}))})),mt=function(e){var t=e.name;return Object(i.jsx)(D.a,{style:{fontWeight:"lighter",overflowWrap:"anywhere"},variant:"h5",children:t&&"Hello ".concat(t)})},vt=function(e){var t=e.storyName;return Object(i.jsxs)(D.a,{variant:"h3",style:{color:"gray",fontWeight:"lighter"},children:["Field Transcription for"," ",Object(i.jsx)(p.a,{component:"span",style:{color:"black"},children:t})]})},yt=function(e){var t=e.storyName,n=e.steps,r=e.logOutAction,a=Object(c.useContext)(U),o=a.userName,s=a.setName,l=a.clearName,u=jt();return Object(i.jsxs)(f.a,{children:[Object(i.jsx)(ft,{setName:s,show:!o}),Object(i.jsxs)(f.a,{className:u.introContainer,children:[Object(i.jsx)(vt,{storyName:t}),Object(i.jsx)(mt,{name:o}),o&&Object(i.jsx)(gt,{onClick:function(){l(),r()},children:"This is not me!"})]}),Object(i.jsx)("div",{style:{marginBottom:"16px"},children:"There are 3 stages to transcribing, select which stage you are performing"}),Object(i.jsx)(p.a,{children:Object(i.jsx)(O.a,{cols:3,cellHeight:"auto",spacing:20,children:n.map((function(e){return Object(i.jsx)(x.a,{children:Object(i.jsx)(dt,Object(g.a)({},e))},e.title)}))})})]})},kt=Object(m.a)({buildVersion:{fontFamily:"Open Sans",color:"#7a7a7a",fontWeight:"bold",fontSize:"19px",position:"absolute",paddingTop:"10px",top:"-5px",left:"122px"},titleRow:{marginTop:"5px",display:"flex",flexDirection:"row",height:"48px",position:"relative"},logoContainer:{position:"relative",paddingTop:"6px",width:"25%"},titleContainer:{width:"50%",height:"48px",marginTop:"10px",paddingLeft:"15px",paddingRight:"15px",textAlign:"center"},titleWrapper:{fontSize:"13pt",margin:"3px",display:"inline-block"},contextMenuButton:{position:"absolute",right:0}}),Ct=n.p+"static/media/logo_web.d3de7844.svg",wt=function(e){var t=e.children,n=e.title,r=e.contextMenuItems,a=e.hidden,o=kt(),s=Object(c.useRef)(null),u=V(!1),d=Object(l.a)(u,3),j=d[0],b=d[1],h=d[2];return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)(f.a,{style:{height:"calc(100vh - 5px)",width:"100%",padding:0,marginTop:"5px",display:"flex",flexDirection:"column"},children:[a?null:Object(i.jsxs)(f.a,{children:[Object(i.jsxs)("div",{className:o.titleRow,children:[Object(i.jsxs)("div",{className:o.logoContainer,children:[Object(i.jsx)("img",{src:Ct,alt:"logo",width:"120px",height:"36px"}),Object(i.jsx)("span",{className:o.buildVersion,children:"TITAN"})]}),Object(i.jsx)("div",{className:o.titleContainer,children:Object(i.jsx)("div",{className:o.titleWrapper,children:n})}),Object(i.jsx)(Ue.a,{onClickAway:function(){return h(!1)},children:Object(i.jsx)(Ye.a,{className:o.contextMenuButton,onClick:b,ref:s,children:Object(i.jsx)(_e.a,{})})}),Object(i.jsx)(qe,{show:j,anchor:s.current,menuItems:r})]}),Object(i.jsx)(F.a,{})]}),t]})})};!function(e){e[e.Dashboard=0]="Dashboard",e[e.Chunking=1]="Chunking",e[e.Transcribing=2]="Transcribing",e[e.Reviewing=3]="Reviewing"}(ot||(ot={}));var St=ot,Tt=function(e,t){return Object(c.useMemo)((function(){return[{title:"Chunking",description:"We need to know when people are talking in the story, so that we can transcribe them.",progress:t[0].progress,onSelect:function(){return e(St.Chunking)},enabled:t[0].enabled},{title:"Transcription",description:"Writing down exactly what is said in each chunk of the story.",progress:t[1].progress,onSelect:function(){return e(St.Transcribing)},enabled:t[1].enabled},{title:"Review",description:"Reviewing content is key to making sure we represent participants authentically.",progress:t[2].progress,onSelect:function(){return e(St.Reviewing)},enabled:t[2].enabled}]}),[e,t])},Mt=n(220),Nt=n(221),Rt=n(222),Bt="8px",Pt=Object(m.a)({videoPlayerContainer:{position:"relative",overflow:"hidden"},inputField:{width:"100%"},chunkProgressRail:{height:Bt,color:"#d9534f"},chunkProgressTrack:{height:Bt,color:"#d9534f"},chunkProgressMark:{height:Bt,width:"4px",backgroundColor:"#FFFFFF",opacity:.8},stepperDots:{backgroundColor:"#d9534f"},stepperDotsContainer:{flexWrap:"wrap"},stepperDot:{margin:"2px"}}),Dt=n(217),Ft=n(218),Wt=n(219),It=Object(m.a)({slideshowContainer:{display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"flex-end",width:"100%"},slideshowContentContainer:{flexGrow:4}}),Et=function(e){var t=e.onNavigate,n=e.onComplete,r=e.currentPage,c=e.numberOfPages,a=e.children,o=e.style,s=e.contentContainerStyle,l=e.leftColumn,u=e.rightColumn,d=It();return Object(i.jsxs)("div",{className:d.slideshowContainer,style:o,children:[null!==l&&void 0!==l?l:Object(i.jsx)(pe,{round:!0,"aria-label":"Previous",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:0===r,onClick:function(){return t("prev")},children:Object(i.jsx)(Dt.a,{})}),Object(i.jsx)(p.a,{style:Object(g.a)({},s),className:d.slideshowContentContainer,children:a}),null!==u&&void 0!==u?u:n&&r===c-1?Object(i.jsx)(pe,{round:!0,"aria-label":"Complete",style:{color:"#FFFFFF",backgroundColor:"#40bf11",alignSelf:"flex-start",marginTop:"32px"},onClick:n,children:Object(i.jsx)(Ft.a,{})}):Object(i.jsx)(pe,{round:!0,"aria-label":"Next",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:r===c-1,onClick:function(){return t("next")},children:Object(i.jsx)(Wt.a,{})})]})},At=function(e){var t=e.inputRef,n=e.transcriptionValue,r=e.transcriptionIcon,c=e.onChange;return Object(i.jsx)(W,{title:r,cardStyle:{margin:"16px 8px 0 8px"},children:Object(i.jsx)(fe.a,{autoFocus:!0,multiline:!0,rows:7,inputRef:t,style:{width:"100%"},variant:"outlined",label:"Transcription",value:n,onChange:function(e){c(e.target.value)}})})},Vt=function(e,t){return le(e.transcriptions,(function(e){return e.creatorid===t}))?e.transcriptions.filter((function(e){return e.creatorid===t}))[0]:void 0},Lt=function(e,t){for(var n=[],r=e.starttimeseconds+4/t;r<e.endtimeseconds;)n.push(r),r+=5/t;return r!==e.endtimeseconds&&n.push(e.endtimeseconds),n},zt=function(e,t){var n=e+1/t;return n>t?t:n},Ut=function(e,t,n,r,i,a,o){var s=Object(c.useCallback)((function(n,r,c,o){var s,l,u=(s=r[c-1],l=e[n],null!==s&&void 0!==s?s:l.starttimeseconds);return a(u),i({start:u,end:zt(r[c],t)}),{miniChunks:r,currentChunk:n,currentMiniChunk:c,transcription:o}}),[a,i,e,t]);return Object(c.useCallback)((function(i,c){var a,l;switch(r&&["go to next page","go to previous page","flush transcription changes"].includes(c.actionType)&&n(e[i.currentChunk],i.transcription,r),c.actionType){case"go to next page":if(i.currentMiniChunk===i.miniChunks.length-1&&i.currentChunk<e.length-1){var u,d,j=i.currentChunk+1;return s(j,Lt(e[j],t),0,null!==(u=null===(d=Vt(e[j],null!==r&&void 0!==r?r:""))||void 0===d?void 0:d.content)&&void 0!==u?u:"")}if(i.currentMiniChunk<i.miniChunks.length-1)return s(i.currentChunk,i.miniChunks,i.currentMiniChunk+1,i.transcription);o();break;case"go to previous page":if(0===i.currentMiniChunk&&i.currentChunk>0){var b,h,p=i.currentChunk-1,f=Lt(e[p],t);return s(p,f,f.length-1,null!==(b=null===(h=Vt(e[p],null!==r&&void 0!==r?r:""))||void 0===h?void 0:h.content)&&void 0!==b?b:"")}if(i.currentMiniChunk>0)return s(i.currentChunk,i.miniChunks,i.currentMiniChunk-1,i.transcription);break;case"transcription changed":return void 0!==c.newTranscription?Object(g.a)(Object(g.a)({},i),{},{transcription:c.newTranscription}):Object(g.a)({},i);case"go to first mini chunk":return s(i.currentChunk,i.miniChunks,0,i.transcription),Object(g.a)(Object(g.a)({},i),{},{currentMiniChunk:0});case"go to last mini chunk":var O=i.miniChunks.length-1;return s(i.currentChunk,i.miniChunks,O,i.transcription),Object(g.a)(Object(g.a)({},i),{},{currentMiniChunk:O});case"refresh mini chunks":var x=Lt(e[i.currentChunk],t);return s(i.currentChunk,x,0,i.transcription),Object(g.a)(Object(g.a)({},i),{},{currentMiniChunk:0,miniChunks:x,transcription:null!==(a=null===(l=Vt(e[i.currentChunk],null!==r&&void 0!==r?r:""))||void 0===l?void 0:l.content)&&void 0!==a?a:""})}return i}),[e,t,n,r,o,s])},Yt=n(87),_t=function(e,t){var n=Object(c.useState)(!1),r=Object(l.a)(n,2)[1],i=Object(c.useState)(!1),a=Object(l.a)(i,2),o=a[0],s=a[1],u=Object(Yt.a)((function(){t(o),r(!1)}),500);return Object(c.useCallback)((function(){r((function(t){return t||s(e),!0})),u(),t(!1)}),[e,t,u])},Ht=function(){return Object(i.jsx)("div",{})},Jt=function(e){var t=e.story_id,n=e.atExit,r=e.onboarding,a=de.useChunksState(),o=Object(l.a)(a,1)[0],s=r.showOnboardingModal,u=r.dismissOnboardingModal,d=ae(),j=d.progressState,h=d.playerRef,O=Object(l.a)(d.splitState,2),x=O[0],g=O[1],m=d.duration,v=d.controller,y=Object(l.a)(d.playingState,2),C=y[0],w=y[1],S=je(),T=Object(c.useContext)(U).userName,M=j.setProgressWithVideoUpdate,N=Ut(o,m,S,T,g,M,n),B=Object(c.useReducer)(N,{currentChunk:0,currentMiniChunk:0,miniChunks:[],transcription:""}),P=Object(l.a)(B,2),D=P[0],F=P[1];Object(c.useEffect)((function(){0!==m&&F({actionType:"refresh mini chunks"})}),[m]);var W=Object(c.useMemo)((function(){return D.currentChunk===o.length-1&&D.currentMiniChunk===D.miniChunks.length-1}),[D.currentChunk,D.currentMiniChunk,D.miniChunks,o]),I=Pt(),E=Object(c.useRef)(null);Object(c.useEffect)((function(){(E.current?E.current:{focus:function(){return null}}).focus()}),[C,D.currentChunk,D.currentMiniChunk]);var A=function(){F({actionType:"flush transcription changes"}),n()},V=_t(C,w);return Object(i.jsxs)("div",{children:[Object(i.jsx)(Qe,{open:0===m}),Object(i.jsx)(f.a,{style:{marginBottom:"4px"},children:Object(i.jsx)(De,{action:A})}),Object(i.jsx)(it,{show:s,dismiss:u,title:Object(i.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),steps:["You are about to Transcribe the chunks.","Each chunk has been divided into 5 second clips for you. These clips will loop.","When you type, the video will pause until you stop typing",'When you are done transcribing a clip press the ">" button'],startButtonContent:Object(i.jsx)("div",{children:"Start Transcribing"})}),o.length&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(p.a,{className:I.videoPlayerContainer,children:Object(i.jsx)(ce,{progressState:j,playerRef:h,url:"http://".concat(Ce,":8845/api/watch/getvideo/").concat(t),controller:v,loop:!0})}),Object(i.jsxs)("div",{style:{margin:"0 8px 0 8px"},children:[Object(i.jsx)(Mt.a,{variant:"dots",steps:D.miniChunks.length,activeStep:D.currentMiniChunk,position:"static",classes:{dotActive:I.stepperDots,dots:I.stepperDotsContainer,dot:I.stepperDot},nextButton:Object(i.jsx)(_.a,{onClick:function(){return F({actionType:"go to last mini chunk"})},children:"Last"}),backButton:Object(i.jsx)(_.a,{onClick:function(){return F({actionType:"go to first mini chunk"})},children:"First"})}),Object(i.jsx)(Et,{currentPage:D.currentChunk,onNavigate:function(){return null},numberOfPages:o.length,onComplete:A,leftColumn:Object(i.jsx)("div",{children:Object(i.jsx)(pe,{onClick:function(){return F({actionType:"go to previous page"})},children:Object(i.jsx)(Nt.a,{})})}),rightColumn:Object(i.jsx)("div",{children:Object(i.jsx)(pe,{style:{backgroundColor:W?"green":"#d9534f"},onClick:function(){return F({actionType:"go to next page"})},children:W?Object(i.jsx)(b.a,{}):Object(i.jsx)(Rt.a,{})})}),children:Object(i.jsx)(At,{transcriptionIcon:Object(i.jsxs)("div",{style:{display:"flex",flexDirection:"column",margin:"0 8px 0 8px"},children:[Object(i.jsx)("span",{style:{fontWeight:600,overflowWrap:"anywhere"},children:R(o[D.currentChunk])}),Object(i.jsx)(Q.a,{ThumbComponent:Ht,value:[100*o[D.currentChunk].starttimeseconds,100*o[D.currentChunk].endtimeseconds],classes:{rail:I.chunkProgressRail,track:I.chunkProgressTrack,mark:I.chunkProgressMark,markActive:I.chunkProgressMark},marks:[{value:100*x.start,label:k(D.miniChunks[D.currentMiniChunk]*m)}]})]}),inputRef:E,transcriptionValue:D.transcription,onChange:function(e){V(),F({actionType:"transcription changed",newTranscription:e})}})})]})]}),Object(i.jsx)("div",{style:{position:"absolute",left:0,bottom:0,width:"100%"},children:!1})]})},qt=n(65),Gt=n.n(qt),Xt=n(88),Kt=n(62),Qt=n.n(Kt),Zt=function(e,t){Qt.a.request({url:"http://".concat(Ce,":8845/api/watch/savedit/").concat(t,"?apikey=").concat("replaceme"),method:"POST",withCredentials:!0,data:e})},$t=function(e){var t,n=Object(c.useState)(void 0),r=Object(l.a)(n,2),i=r[0],a=r[1],o=Object(c.useMemo)((function(){var e;return null!==(e=null===i||void 0===i?void 0:i.transcription.chunks)&&void 0!==e?e:[]}),[null===i||void 0===i||null===(t=i.transcription)||void 0===t?void 0:t.chunks]),s=Object(c.useCallback)(function(){var t=Object(Xt.a)(Gt.a.mark((function t(n){var r;return Gt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n,t.next=3,Qt.a.request({withCredentials:!0,url:"http://".concat(Ce,":8845/api/watch/edit/").concat(e),transformResponse:function(e){var t,n,r;return null!==(t=null===(n=JSON.parse(e))||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[]}});case 3:t.t1=t.sent.data,r=(0,t.t0)(t.t1),a((function(t){var n=void 0===t?void 0:Object(g.a)(Object(g.a)({},t),{},{transcription:{chunks:r}});return n&&Zt(n,e),n}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]);Object(c.useEffect)((function(){Qt.a.request({url:"http://".concat(Ce,":8845/api/watch/edit/").concat(e),withCredentials:!0,transformResponse:function(e){return JSON.parse(e)}}).then((function(e){var t,n,r,i;a(e.data),i=null!==(t=null===(n=e.data)||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[],a((function(e){return void 0===e?void 0:Object(g.a)(Object(g.a)({},e),{},{transcription:{chunks:i}})}))}))}),[e]);var u=Object(c.useMemo)((function(){return[o,s]}),[o,s]);return{storyTitle:i&&i.title,chunksState:u}},en=n(200),tn=n(156),nn=n(227),rn=n(223),cn=n(224),an=Object(m.a)({doneButton:{backgroundColor:"green",color:"white"},cardContainer:{marginTop:"8px",marginBottom:"8px",padding:"0 8px 0 8px",width:"100%"}}),on=function(e){var t=e.atExit,n=e.story_id,r=e.onboarding,a=r.showOnboardingModal,o=r.dismissOnboardingModal,s=ae(),u=s.progressState,d=Object(l.a)(s.splitState,2)[1],j=s.controller,h=s.playerRef,O=s.duration,x=u.setProgressWithVideoUpdate,m=de.useChunksState(),v=Object(l.a)(m,1)[0],y=an(),k=v.filter(T),C=nt(k),w=C.page,S=C.goTo,M=C.lastPage,N=Object(c.useMemo)((function(){return k[w]}),[w,k]);Object(c.useEffect)((function(){d({start:N.starttimeseconds,end:N.endtimeseconds}),x(N.starttimeseconds)}),[w,v,N,x,d]);var R=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1];return function(e,n,r){t((function(t){return t.map((function(t){return t.id===e.id&&le(t.transcriptions,(function(e){return e.id===n.id}))?Object(g.a)(Object(g.a)({},t),{},{review:{reviewedat:new Date,selectedtranscription:n.id,reviewedby:r}}):t}))}))}}(),B=function(){var e=de.useChunksState(),t=Object(l.a)(e,2)[1];return function(e){t((function(t){return t.map((function(t){return t.id===e.id?Object(g.a)(Object(g.a)({},t),{},{review:void 0}):t}))}))}}(),P=Object(c.useContext)(U).userName,W=Object(c.useState)(""),I=Object(l.a)(W,2),A=I[0],V=I[1],L=Object(c.useState)(void 0),z=Object(l.a)(L,2),Y=z[0],_=z[1];Object(c.useEffect)((function(){V(Y?Y.content:"")}),[Y]);var H=je();return Object(i.jsxs)("div",{children:[Object(i.jsx)(Qe,{open:0===O}),Object(i.jsx)(f.a,{style:{marginTop:"4px"},children:Object(i.jsx)(De,{action:t})}),Object(i.jsx)(it,{show:a,dismiss:o,steps:["You are about to review the transcriptions made on the video.","For each chunk, select one of the transcriptions from the list. You can do this by clicking on the text or the check box to the left of the text.","You can also edit the transcriptions by clicking on the pencil button above the text."],title:Object(i.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),startButtonContent:Object(i.jsx)("div",{children:"Start Reviewing"})}),Object(i.jsx)(ke,{open:void 0!==Y,header:Object(i.jsx)(Ae,{message:Object(i.jsxs)("div",{style:{whiteSpace:"pre"},children:["You Are Editing"," ",Object(i.jsx)("span",{style:{textDecoration:"underline"},children:"".concat(null===Y||void 0===Y?void 0:Y.creatorid)}),"'s Transcription"]})}),exit:function(){_(void 0)},children:Object(i.jsxs)("div",{style:{position:"relative"},children:[Object(i.jsx)(en.a,{style:{maxHeight:"300px",overflow:"scroll"},children:N.transcriptions.filter((function(e){return e.id!==(null===Y||void 0===Y?void 0:Y.id)})).map((function(e){return Object(i.jsxs)(tn.a,{style:{display:"flex"},children:[Object(i.jsxs)("span",{style:{alignSelf:"flex-start",fontWeight:600,whiteSpace:"pre"},children:[e.creatorid,":"," "]}),Object(i.jsx)("div",{style:{whiteSpace:"pre",overflowWrap:"anywhere"},children:e.content})]})}))}),Object(i.jsx)(At,{transcriptionValue:A,onChange:V}),Object(i.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(i.jsxs)(pe,{onClick:function(){Y&&H(N,A,Y.creatorid),_(void 0)},style:{margin:"8px",backgroundColor:"#40bf11",position:"relative",bottom:0,right:0},disabled:""===A,children:[Object(i.jsx)(Ft.a,{}),Object(i.jsx)("span",{style:{marginLeft:"4px",fontSize:"1.05rem"},children:"Complete"})]})})]})}),Object(i.jsx)(p.a,{children:Object(i.jsx)(ce,{playerRef:h,progressState:u,url:"http://".concat(Ce,":8845/api/watch/getvideo/").concat(n),controller:j})}),Object(i.jsx)(f.a,{children:Object(i.jsx)(Et,{currentPage:w,onNavigate:S,numberOfPages:k.length,onComplete:t,style:{width:"100%"},contentContainerStyle:{margin:"0 64px 0 64px"},leftColumn:Object(i.jsx)("div",{style:{position:"fixed",bottom:0,left:0,margin:"16px",zIndex:1},children:Object(i.jsx)(pe,{onClick:function(){return S("prev")},children:Object(i.jsx)(Nt.a,{})})}),rightColumn:Object(i.jsx)("div",{style:{position:"fixed",bottom:0,right:0,margin:"16px",zIndex:1},children:Object(i.jsx)(pe,{onClick:function(){return M?t():S("next")},style:{backgroundColor:M?"green":"#d9534f"},children:M?Object(i.jsx)(b.a,{}):Object(i.jsx)(Rt.a,{})})}),children:Object(i.jsx)(E,{chunk:N,children:N.transcriptions.map((function(e){var t;return e.content&&Object(i.jsxs)(p.a,{className:y.cardContainer,children:[Object(i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(i.jsxs)("div",{style:{fontSize:"1.2rem",display:"flex",justifyContent:"center",paddingLeft:"10px"},children:[Object(i.jsx)(rn.a,{}),Object(i.jsx)("div",{style:{marginLeft:"4px",overflowWrap:"anywhere"},children:e.creatorid})]}),Object(i.jsx)(pe,{onClick:function(){return _(e)},style:{padding:"0px",height:"32px",width:"32px",minWidth:"32px"},children:Object(i.jsx)(cn.a,{fontSize:"small"})})]}),Object(i.jsxs)("div",{onClick:function(){var t;return P&&((null===(t=N.review)||void 0===t?void 0:t.selectedtranscription)!==e.id?R(N,e,P):B(N))},style:{display:"flex",flexDirection:"row"},children:[Object(i.jsx)(nn.a,{checked:(null===(t=N.review)||void 0===t?void 0:t.selectedtranscription)===e.id,onChange:function(t,n){return P&&(n?R(N,e,P):B(N))},style:{backgroundColor:"initial"}}),Object(i.jsx)(D.a,{variant:"h6",style:{padding:"8px",overflowWrap:"anywhere",whiteSpace:"pre"},children:e.content})]}),Object(i.jsx)(F.a,{style:{margin:"16px 0 16px 0"}})]},e.id)}))})})})]})},sn=n(89),ln=[["year",31536e3],["month",2592e3],["day",86400],["hour",3600],["minute",60],["second",1]],un=function(e){var t=function(e){var t,n=Object(sn.a)(ln);try{for(n.s();!(t=n.n()).done;){var r=Object(l.a)(t.value,2),i=r[0],c=r[1],a=Math.floor(e/+c);if(a>=1)return{interval:a,epoch:i}}}catch(o){n.e(o)}finally{n.f()}return{interval:0,epoch:"second"}}(Math.floor((+new Date-+new Date(e))/1e3)),n=t.interval,r=t.epoch,i=1===n?"":"s";return"second"===r?"Less than a minute ago":"".concat(n," ").concat(r).concat(i," ago")},dn=function(e){var t,n,r,c,a=e.contribution,o=a.type,s=a.name,l=a.chunk;return Object(i.jsxs)("span",{style:{display:"flex",flexWrap:"wrap"},children:[Object(i.jsxs)("div",{style:{whiteSpace:"pre"},children:[Object(i.jsx)("span",{style:{fontWeight:"bold"},children:function(e){switch(e){case"chunk":return"Created ";case"transcription":return"Transcribed ";case"review":return"Reviewed "}}(o)}),"the chunk "]}),Object(i.jsxs)("div",{style:{overflowWrap:"anywhere"},children:['"',R(l),'"']})," (","".concat(k(N(M(l.starttimestamp)))," - ").concat(k(N(M(l.endtimestamp)))),")",Object(i.jsx)(D.a,{variant:"subtitle2",style:{marginLeft:"4px",fontWeight:600},children:un("chunk"===o?l.updatedat:"transcription"===o?null!==(t=null===(n=Vt(l,s))||void 0===n?void 0:n.updatedat)&&void 0!==t?t:new Date:null!==(r=null===(c=l.review)||void 0===c?void 0:c.reviewedat)&&void 0!==r?r:new Date)})]})},jn=function(e){var t=e.show,n=e.exit,r=e.chunks,a=Object(c.useMemo)((function(){return Array.from(function(e){return e.map((function(e){return{name:e.creatorid,type:"chunk",chunk:e}})).concat(e.reduce((function(e,t){return e.concat(t.transcriptions.map((function(e){return{name:e.creatorid,type:"transcription",chunk:t}})))}),[])).concat(e.reduce((function(e,t){return t.review?e.concat([{name:t.review.reviewedby,type:"review",chunk:t}]):e}),[]))}(r).reduce((function(e,t){return e.get(t.name)?e.set(t.name,e.get(t.name).concat([t])):e.set(t.name,[t])}),new Map))}),[r]);return Object(i.jsx)(ke,{header:Object(i.jsx)(D.a,{variant:"h3",style:{fontWeight:"lighter"},children:"Contributions"}),open:t,exit:n,children:Object(i.jsx)(ve,{children:Object(i.jsx)(f.a,{style:{height:"80vh",width:"90vw",overflow:"scroll"},children:Object(i.jsx)(O.a,{cols:1,cellHeight:"auto",children:a.map((function(e){return Object(i.jsx)(x.a,{children:Object(i.jsx)(W,{title:Object(i.jsx)("div",{style:{overflowWrap:"anywhere"},children:e[0]}),children:Object(i.jsx)(en.a,{children:e[1].map((function(e){return Object(i.jsx)(tn.a,{children:Object(i.jsx)(dn,{contribution:e})},"".concat(e.chunk.id).concat(e.type))}))})})},e[0])}))})})})})},bn=function(){var e=Object(c.useState)(St.Dashboard),t=Object(l.a)(e,2),n=t[0],r=t[1],a=de.ChunksProvider,o=function(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){r(window.location.href.split("/")[4])}),[]),n}(),s=$t(o),u=s.storyTitle,d=Object(l.a)(s.chunksState,2),j=d[0],b=d[1],h=Object(c.useMemo)((function(){return w(j)}),[j]),p=Object(c.useMemo)((function(){return j.length?function(e){return e.reduce((function(e,t){return e+(T(t)?1:0)}),0)}(j)/j.length:0}),[j]),f=Object(c.useMemo)((function(){return j.length?function(e){return e.reduce((function(e,t){return e+(t.review?1:0)}),0)}(j)/j.length:0}),[j]),O=Tt(r,[{progress:100*h,enabled:!0},{progress:100*p,enabled:h>0},{progress:100*f,enabled:p>0}]),x=V(!1),g=Object(l.a)(x,2),m=g[0],v=g[1],y=L("showChunkEditorOnboardingModal","true"),k=Object(l.a)(y,2),C=k[0],S=k[1],M=L("showTranscriberOnboardingModal","true"),N=Object(l.a)(M,2),R=N[0],B=N[1],P=L("showReviewerOnboardingModal","true"),D=Object(l.a)(P,2),F=D[0],W=D[1],I=Object(c.useCallback)((function(){return r(St.Dashboard)}),[]),E=Object(c.useMemo)((function(){return[{content:Object(i.jsx)("div",{children:"Show Contributions"}),handler:v}].concat(n===St.Chunking?{content:Object(i.jsx)("div",{children:"View instructions"}),handler:function(){S("true")}}:n===St.Reviewing?{content:Object(i.jsx)("div",{children:"View instructions"}),handler:function(){W("true")}}:[])}),[n,S,W,v]);return Object(i.jsx)(a,{state:[j,b],children:Object(i.jsx)(Y,{children:Object(i.jsxs)("main",{children:[Object(i.jsx)(jn,{chunks:j,show:m,exit:v}),Object(i.jsx)(wt,{title:St[n],hidden:n===St.Transcribing,contextMenuItems:E,children:n===St.Dashboard?Object(i.jsx)(yt,{steps:O,storyName:u||"Loading",logOutAction:function(){S("true"),B("true"),W("true")}}):n===St.Chunking?Object(i.jsx)(ct,{story_id:o,atExit:I,onboarding:{showOnboardingModal:"true"===C,dismissOnboardingModal:function(){return S("false")}}}):n===St.Transcribing?Object(i.jsx)(Jt,{story_id:o,atExit:I,onboarding:{showOnboardingModal:"true"===R,dismissOnboardingModal:function(){return B("false")}}}):n===St.Reviewing?Object(i.jsx)(on,{atExit:I,story_id:o,onboarding:{showOnboardingModal:"true"===F,dismissOnboardingModal:function(){return W("false")}}}):null})]})})})},hn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,237)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),c(e),a(e)}))};s.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(bn,{})}),document.getElementById("root")),hn()}},[[153,1,2]]]);
//# sourceMappingURL=main.3a899fac.chunk.js.map