(this.webpackJsonptranscription=this.webpackJsonptranscription||[]).push([[0],{110:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var r,i=n(0),c=n.n(i),a=n(15),o=n.n(a),s=(n(110),n(6)),l=n(30),u=n(214),d=n(196),j=n(215),b=n(216),h=n(226),p=n(199),f=n(212),O=n(213),x=n(7),g=n(191),m=function(e){return(t=Math.floor(e))<10?"0".concat(t<0?0:t):t.toString();var t},v=function(e){return"".concat(m(e/3600),":").concat(m(e/60),":").concat(m(e%60),":").concat(m(Math.round(100*(e-Math.floor(e)))))},y=function(e){return e>3600?v(e).substring(0,8):v(e).substring(3,8)},k=function(e){return e.length>0?e[e.length-1].endtimestamp:"00:00:00:00"},C=function(e){return e.length>0?e[e.length-1].endtimeseconds:0},w=function(e,t){for(var n=0;n<e.length;n++)if(t>e[n].starttimeseconds&&t<e[n].endtimeseconds)return e[n]},S=function(e){return e.transcriptions.reduce((function(e,t){return e||""!==t.content}),!1)},T=function(e){return{hours:Number(e.slice(0,2)),minutes:Number(e.slice(3,5)),seconds:Number(e.slice(6,8)),milliseconds:Number(e.slice(9,11))}},M=function(e){return 60*e.hours*60+60*e.minutes+e.seconds},N=function(e){return e.name?e.name:"".concat(M(T(e.endtimestamp))-M(T(e.starttimestamp))," second chunk")},R=n(186),B=n(189),P=n(156),D=n(190),F=n(1),W=function(e){var t=e.title,n=e.children,r=e.contentStyle,i=e.cardStyle;return Object(F.jsx)(R.a,{variant:"outlined",style:Object(x.a)({},i),children:Object(F.jsxs)(B.a,{style:Object(x.a)({},r),children:[Object(F.jsx)(P.a,{variant:"h5",component:"h2",children:t}),t?Object(F.jsx)(D.a,{style:{margin:"16px 0 16px 0"}}):null,n]})})},I=Object(g.a)({titleContainer:{fontSize:"1.2rem",position:"relative"}}),E=function(e){var t=e.chunk,n=e.children,r=e.style,i=e.transcriptionIcon,c=I(),a=function(e){return{start:T(e.starttimestamp),end:T(e.endtimestamp)}}(t),o=M(a.end),s=M(a.start);return Object(F.jsx)(W,{title:Object(F.jsx)("div",{children:Object(F.jsxs)("span",{className:c.titleContainer,style:{display:"flex",flexDirection:"column"},children:[Object(F.jsxs)("span",{style:{fontWeight:600,overflowWrap:"anywhere",display:"flex",justifyContent:"space-between"},children:[N(t),i]}),"".concat(y(s)," - ").concat(y(o))]})}),cardStyle:Object(x.a)(Object(x.a)({},r),{},{position:"relative",margin:"8px"}),children:n})},A=Object(g.a)({videoPlayerContainer:{margin:"auto"},actionButton:{"&:hover":{background:"#d9534f"}},chunksList:{flexWrap:"nowrap"},backButton:{background:"transparent",color:"black",fontSize:"16px"},backButtonContainer:{marginTop:"4px"},onboardingTitle:{margin:0},chunkCardBody:{marginTop:"8px",position:"relative"},newChunkButtonContainer:{position:"absolute",right:0,bottom:0,margin:"16px 16px 32px 16px",display:"flex"}}),V=function(e){var t=Object(i.useState)(e),n=Object(s.a)(t,2),r=n[0],c=n[1];return[r,function(){return c((function(e){return!e}))},c]},L=function(e,t){var n,r=Object(i.useState)(null!==(n=window.localStorage.getItem(e))&&void 0!==n?n:t),c=Object(s.a)(r,2),a=c[0],o=c[1],l=V(!1),u=Object(s.a)(l,2),d=u[0],j=u[1];if(!d){var b=window.localStorage.getItem(e);j(),b&&o(b)}return[a,Object(i.useCallback)((function(t){"string"==typeof t||null===t?(o(t),window.localStorage.setItem(e,null!==t&&void 0!==t?t:"")):t&&o((function(n){var r=t(n);return window.localStorage.setItem(e,null!==r&&void 0!==r?r:""),r}))}),[e]),Object(i.useCallback)((function(){window.localStorage.removeItem(e),o(void 0)}),[o,e])]},z={userName:void 0,setName:function(){return null},clearName:function(){return null}},U=Object(i.createContext)(z),Y=function(e){var t=e.children,n=L("name"),r=Object(s.a)(n,3),c=r[0],a=r[1],o=r[2],l=Object(i.useMemo)((function(){return{userName:c,setName:a,clearName:o}}),[c,a,o]);return Object(F.jsx)(U.Provider,{value:l,children:t})},_=n(193),H=n(194),J=n(195),q=n(197),G=n(57),X=n.n(G),K=function(e,t){var n=Object(i.useState)(t);return null!==e&&void 0!==e?e:n},Q=n(234),Z=Object(g.a)({progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:6},progressBarRail:{height:6},progressBarTrack:{height:6},progressBarThumb:{height:18,width:18,marginTop:-6},progressBarMark:{height:14,marginTop:-3},markedSlider:{margin:0}}),$=function(e){var t=e.styles,n=Object(l.a)(e,["styles"]),r=Z();return Object(F.jsx)("div",{style:t,children:Object(F.jsx)(Q.a,Object(x.a)({classes:{colorPrimary:r.progressBarColor,root:r.progressBarRoot,rail:r.progressBarRail,track:r.progressBarTrack,thumb:r.progressBarThumb,mark:r.progressBarMark,marked:r.markedSlider}},n))})},ee=n(86),te=function(e,t,n,r,c,a,o){var l=Object(s.a)(t,2),u=l[0],d=l[1],j=Object(i.useState)(!1),b=Object(s.a)(j,2),h=b[0],p=b[1],f=Object(i.useState)(!1),O=Object(s.a)(f,2),x=O[0],g=O[1],m=e.progress,v=e.setProgress,y=e.setProgressWithVideoUpdate;Object(i.useEffect)((function(){h&&n.current&&r(n.current.getDuration())}),[r,n,h]);var k=Object(i.useMemo)((function(){return{playing:!x&&u,progressInterval:100,onProgress:function(e){var t=e.played;return v(t)},onReady:function(){return p(!0)},onEnded:function(){return d(!1)}}}),[x,u,d,v]),C=Object(ee.a)((function(e){return y(e/100)}),10),w=function(e,t){var n=Object(i.useState)(e),r=Object(s.a)(n,2),c=r[0],a=r[1],o=Object(i.useCallback)((function(e){a(e),t(e)}),[a,t]);return{value:c,setWithoutVideoUpdate:a,setWithVideoUpdate:o}}(100*m,C),S=w.value,T=w.setWithVideoUpdate,M=w.setWithoutVideoUpdate;Object(i.useEffect)((function(){M(100*m)}),[m,M]);var N=Object(i.useMemo)((function(){return{value:S,min:100*c.start,max:100*c.end,step:1e-4,onChange:function(e,t){a&&a(),g(!0),T(t)},onChangeCommitted:function(e,t){g(!1)}}}),[S,c,a,T]);return Object(i.useEffect)((function(){m>c.end+1e-4?o&&!x?y(c.start):(y(c.end),d(!1)):m<c.start-1e-4&&y(c.start+.1)}),[m,u,d,c.end,c.start,o,y,x]),{playerProps:k,progressBarProps:N,showControls:!0,isPlaying:u,toggleIsPlaying:function(){return d((function(e){return!e}))}}},ne=n(233),re=function(e){var t=e.children,n=e.open,r=e.value;return Object(F.jsx)(ne.a,{open:n,enterTouchDelay:0,placement:"top",title:r,children:t})},ie=Object(g.a)({videoControlsContainer:{display:"flex",left:"50%",position:"absolute",bottom:"50%",transform:"translate(-50%, 50%)"},videoPlayerButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #f54414 90%)"},roundButton:{borderRadius:"50px",width:"64px",height:"64px",color:"white",display:"relative",top:"4px"},videoPlayerContainer:{position:"relative",bottom:0,top:0,right:0,left:0},progressBarContainer:{left:"0",bottom:"0",marginBottom:"-39px",transform:"translateY(calc(-100% - 16px))"},progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:4},progressBarRail:{height:4},progressBarTrack:{height:4},progressBarThumb:{height:12,marginTop:-4},progressBarMark:{height:10,marginTop:-3}}),ce=function(e){var t=e.url,n=e.playerRef,r=e.controller,c=e.sliderMarks,a=e.progressState,o=e.onProgressDrag,l=e.slider,u=e.loop,j=ie(),b=K(null===r||void 0===r?void 0:r.durationState,0),p=Object(s.a)(b,2),f=p[0],O=p[1],g=a.progress,m=a.setProgressWithVideoUpdate,v=K(null===r||void 0===r?void 0:r.playingState,!1),k=K(null===r||void 0===r?void 0:r.splitState,{start:0,end:1}),C=Object(s.a)(k,1)[0],w=te(a,v,n,O,C,o,u),S=w.playerProps,T=w.progressBarProps,M=w.showControls,N=w.isPlaying,R=w.toggleIsPlaying,B=Object(i.useCallback)((function(e){return y((e/100-C.start===0?0:e/100-C.start)*f)}),[f,C.start]),D=Object(i.useCallback)((function(){f&&m((function(e){return e+5/f}))}),[m,f]),W=Object(i.useCallback)((function(){f&&m((function(e){return e-5/f}))}),[m,f]);return Object(F.jsxs)(h.a,{className:j.videoPlayerContainer,children:[Object(F.jsx)(X.a,Object(x.a)({url:t,ref:n,width:"100%",height:"100%",loop:u},S)),M&&Object(F.jsxs)("div",{className:j.videoControlsContainer,children:[Object(F.jsx)("div",{style:{position:"absolute",right:"240px",bottom:-4},children:Object(F.jsx)(_.a,{disableRipple:!0,className:"".concat(j.videoPlayerButton," ").concat(j.roundButton),onClick:W,children:Object(F.jsx)(H.a,{fontSize:"large"})})}),Object(F.jsx)(_.a,{disableRipple:!0,variant:"contained",color:"primary",className:j.videoPlayerButton,onClick:R,children:N&&Object(F.jsx)(J.a,{fontSize:"large"})||Object(F.jsx)(d.a,{fontSize:"large"})}),Object(F.jsx)("div",{style:{position:"absolute",left:"240px",bottom:-4},children:Object(F.jsx)(_.a,{onClick:D,disableRipple:!0,className:"".concat(j.videoPlayerButton," ").concat(j.roundButton),children:Object(F.jsx)(q.a,{fontSize:"large"})})})]}),l||Object(F.jsxs)("div",{className:j.progressBarContainer,children:[Object(F.jsx)(P.a,{variant:"caption",style:{margin:"8px",color:"#FFFFFF"},children:f&&"".concat(y((g-C.start)*f)," / ").concat(y((C.end-C.start)*f))}),Object(F.jsx)($,Object(x.a)({valueLabelDisplay:"auto",valueLabelFormat:B,ValueLabelComponent:re,marks:c||[]},T))]})]})},ae=function(e){var t=Object(i.useRef)(null),n=Object(i.useCallback)((function(e){var n,r,i=null===t||void 0===t||null===(n=t.current)||void 0===n?void 0:n.getSecondsLoaded();i&&i>0&&(null===(r=t.current)||void 0===r||r.seekTo(e,"fraction"))}),[]),r=Object(i.useState)(0),c=Object(s.a)(r,2),a=c[0],o=c[1],l=Object(i.useState)({start:0,end:1}),u=Object(i.useCallback)((function(e){"number"===typeof e?(o(e),n(e)):o((function(t){var r=e(t);return n(r),r}))}),[n]),d=Object(i.useState)(0),j=Object(s.a)(d,2),b=j[0],h=j[1],p=Object(i.useState)(null!==e&&void 0!==e&&e);return{progressState:{progress:a,setProgress:o,setProgressWithVideoUpdate:u},splitState:l,playingState:p,duration:b,controller:{durationState:[b,h],playingState:p,splitState:l},playerRef:t}},oe=n(229),se=function(e,t){return e.reduce((function(e,t,n,r){return n+1<r.length?e.concat([[t,r[n+1]]]):e}),[]).map((function(e){return t(e[0],e[1])}))},le=function(e,t){return e.filter(t).length>0},ue=Object(i.createContext)([[],function(){return null}]),de={ChunksProvider:function(e){var t=e.state,n=e.children;return Object(F.jsx)(ue.Provider,{value:t,children:n})},useChunksState:function(){return Object(i.useContext)(ue)}},je=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];Object(i.useEffect)((function(){console.log("Effect ran because setChunks changed")}),[t]);var n=Object(i.useCallback)(t,[]);return Object(i.useCallback)((function(e,t,r){n((function(n){return n.map((function(n){var i,c;return n.id===e.id?Object(x.a)(Object(x.a)({},(null===(i=n.review)||void 0===i?void 0:i.selectedtranscription)===(null===(c=function(e,t){return e.transcriptions.filter((function(e){return e.creatorid===t}))[0]}(n,r))||void 0===c?void 0:c.id)&&""===t?function(e){return Object(x.a)(Object(x.a)({},e),{},{review:void 0})}(n):n),{},{transcriptions:le(n.transcriptions,(function(e){return e.creatorid===r}))?""===t?n.transcriptions.filter((function(e){return e.creatorid!==r})):n.transcriptions.map((function(e){return e.creatorid===r?Object(x.a)(Object(x.a)({},e),{},{content:t}):e})):n.transcriptions.concat(""===t?[]:[{creatorid:r,content:t,id:Object(oe.a)(),updatedat:new Date}])}):n}))}))}),[n])},be=function(e,t){return""!==e?Object(x.a)(Object(x.a)({},t),{},{name:e}):Object(x.a)(Object(x.a)({},t),{},{name:void 0})},he=Object(g.a)({button:function(e){return{backgroundColor:"#d9534f",color:"#FFFFFF",lineHeight:"34px",height:"60px",borderRadius:e?"50%":"6px",padding:e?"4px":"3px 8px 3px 8px",textTransform:"none","&:hover":{backgroundColor:"#ff7570"},"&:disabled":{backgroundColor:"#fabbb9"}}}}),pe=function(e){var t=e.children,n=e.round,r=e.styles,i=Object(l.a)(e,["children","round","styles"]),c=function(e){return Object(g.a)({overrideStyles:Object(x.a)({},e)})}(r)(),a=he(!!n);return Object(F.jsx)(_.a,Object(x.a)(Object(x.a)({disableRipple:!0,className:"".concat(a.button," ").concat(c.overrideStyles)},i),{},{children:t}))},fe=n(227),Oe=n(230),xe=n(198),ge=n(200),me=n(92),ve=c.a.forwardRef((function(e,t){var n=e.children,r=e.style;return Object(F.jsx)(me.a,{ref:t,elevation:0,style:r,children:n})})),ye=Object(g.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"}}),ke=function(e){var t=e.children,n=e.header,r=e.exit,i=Object(l.a)(e,["children","header","exit"]),c=ye();return Object(F.jsx)(Oe.a,Object(x.a)(Object(x.a)({className:c.modal},i),{},{children:Object(F.jsx)(xe.a,{style:{outline:"none"},children:Object(F.jsxs)(ve,{children:[n&&Object(F.jsxs)(p.a,{children:[Object(F.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"8px"},children:[Object(F.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignContent:"center"},children:n}),Object(F.jsx)(pe,{onClick:r,children:Object(F.jsx)(ge.a,{})})]}),Object(F.jsx)(D.a,{style:{margin:"12px 0px 12px 0px"}})]}),Object(F.jsx)("div",{className:c.modalContentBox,children:t})]})})}))},Ce=window.location.href.split("apikey=")[1],we="localhost",Se=Ce,Te=function(e){var t=1===e["data-index"];return Object(F.jsx)("span",Object(x.a)(Object(x.a)({},e),{},{style:Object(x.a)(Object(x.a)({},e.style),{},{transform:t?"0":"translateY(14px)",backgroundColor:t?"#d9534f":"#f77965"}),children:t?null:Object(F.jsx)("div",{style:{height:"14px",width:"4px",transform:"translateY(-9px)",backgroundColor:"#f77965"}})}))},Me=function(e){var t=e.story_id,n=e.chunk,r=e.storyDuration,c=e.croppedSplitState,a=ae(),o=a.progressState,l=a.controller,u=a.playerRef,d=Object(i.useState)([0,0]),j=Object(s.a)(d,2),b=j[0],h=j[1],f=Object(s.a)(c,2),O=f[0],x=f[1],g=o.setProgressWithVideoUpdate;return Object(i.useEffect)((function(){g(n.starttimeseconds);var e=n.starttimeseconds-2/r,t=n.endtimeseconds+2/r;h([e<0?0:e,t>1?1:t]),x([n.starttimeseconds,n.endtimeseconds])}),[n.starttimeseconds,n.endtimeseconds,r,g,x]),Object(F.jsxs)("div",{children:[Object(F.jsx)(p.a,{children:Object(F.jsx)("h2",{style:{margin:0},children:"Cropping:"})}),Object(F.jsx)(ce,{progressState:o,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(t),controller:l,playerRef:u,slider:Object(F.jsx)($,{value:[100*O[0],100*o.progress,100*O[1]],min:100*b[0],max:100*b[1],step:1e-4,ThumbComponent:Te,onChange:function(e,t){x([t[0]/100,t[2]/100]),o.setProgressWithVideoUpdate(t[1]/100)}})})]})},Ne=function(e){var t=Object(s.a)(e.nameState,2),n=t[0],r=t[1];return Object(F.jsx)(fe.a,{variant:"outlined",label:"Edit Name",style:{marginTop:"8px"},value:n,onChange:function(e){return r(e.target.value)}})},Re=function(e){var t=e.story_id,n=e.chunk,r=e.exit,c=e.storyDuration,a=Object(i.useState)(""),o=Object(s.a)(a,2),l=o[0],u=o[1];Object(i.useEffect)((function(){n&&u(n.name?n.name:"")}),[n]);var d=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];return function(e,n,r,i,c){t((function(t){var a,o,s=(a=e,(o=t).reduce((function(e,t,n){return t.id===a.id?{prev:o[n-1],next:o[n+1]}:e}),{prev:void 0,next:void 0}));return function(e){return e.filter((function(e){return e.endtimeseconds>e.starttimeseconds}))}(t.map((function(t){var i,a;return t.id===e.id?Object(x.a)(Object(x.a)({},c?be(c,t):Object(x.a)(Object(x.a)({},t),{},{name:void 0})),{},{starttimeseconds:r[0],starttimestamp:v(r[0]*n),endtimeseconds:r[1],endtimestamp:v(r[1]*n),updatedat:new Date}):t.id===(null===(i=s.next)||void 0===i?void 0:i.id)?Object(x.a)(Object(x.a)({},t),{},{starttimeseconds:r[1],starttimestamp:v(r[1]*n),updatedat:new Date}):t.id===(null===(a=s.prev)||void 0===a?void 0:a.id)?Object(x.a)(Object(x.a)({},t),{},{endtimeseconds:r[0],endtimestamp:v(r[0]*n),updatedat:new Date}):t})).concat(s.prev||0===r[0]?[]:[{starttimestamp:v(0),starttimeseconds:0,endtimestamp:v(r[0]*n),endtimeseconds:r[0],creatorid:i,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}))}))}}(),j=Object(i.useState)([0,0]),b=Object(s.a)(j,2),h=b[0],p=b[1],f=Object(i.useContext)(U).userName;return Object(F.jsx)(ke,{exit:function(){n&&f&&d(n,c,h,f,l),r()},open:void 0!==n,header:Object(F.jsx)(Ne,{nameState:[l,u]}),children:Object(F.jsx)("div",{style:{paddingBottom:"24px"},children:n&&Object(F.jsx)(Me,{story_id:t,croppedSplitState:[h,p],storyDuration:c,chunk:n})})})},Be=function(e){var t=e.url,n=e.time,r=Object(i.useRef)(null);return Object(F.jsx)(X.a,{crossOrigin:"anonymous",url:t,width:"100%",height:"100%",playing:!1,ref:r,id:"video-thumbnail-player",onReady:function(){var e;null===(e=r.current)||void 0===e||e.seekTo(n,"fraction")}})},Pe=n(66),De=n(202),Fe=Object(g.a)({backButton:{}}),We=function(e){var t=e.action,n=Fe();return Object(F.jsxs)(Pe.a,{className:n.backButton,onClick:t,children:[Object(F.jsx)(De.a,{fontSize:"large"}),Object(F.jsx)(P.a,{variant:"h5",style:{position:"relative",left:-5},children:"Back"})]})},Ie=n(61);!function(e){e[e.True=0]="True"}(r||(r={}));var Ee=function(e,t){var n=Object(i.useState)(r.True),c=Object(s.a)(n,2),a=c[0],o=c[1],l=Object(i.useCallback)((function(){a!==r.True&&(e.apply(void 0,Object(Ie.a)(a)),o(r.True))}),[a,e]);return{attemptingActionWith:a,cancelAction:function(){return o(r.True)},attemptAction:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.apply(void 0,r)?o(r):e.apply(void 0,r)},confirmAction:l}},Ae=n(204),Ve=n(203),Le=function(e){var t=e.message;return Object(F.jsx)("h2",{style:{margin:0},children:Object(F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(F.jsx)(Ve.a,{style:{marginRight:"8px"},fontSize:"large"}),t]})})},ze=function(e){var t=e.actionControls,n=e.warningMessage,i=e.children,c=t.attemptingActionWith,a=t.cancelAction,o=t.confirmAction;return Object(F.jsx)(ke,{open:c!==r.True,exit:a,header:Object(F.jsx)(Le,{message:n}),children:Object(F.jsxs)("div",{children:[c!==r.True&&i.apply(void 0,Object(Ie.a)(c)),Object(F.jsx)("br",{}),Object(F.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(F.jsxs)(pe,{style:{marginTop:"8px"},onClick:o,children:[Object(F.jsx)(Ae.a,{fontSize:"large",style:{marginRight:"8px"}}),Object(F.jsx)(P.a,{variant:"subtitle1",children:"Confirm"})]})})]})})},Ue=function(e){var t=e.chunk,n=e.exit;return Object(F.jsx)(ke,{open:void 0!==t,header:Object(F.jsx)("h2",{style:{margin:0,overflowWrap:"anywhere"},children:'Transcriptions for "'.concat(t&&N(t),'"')}),exit:n,children:Object(F.jsx)("div",{style:{overflow:"scroll"},children:null===t||void 0===t?void 0:t.transcriptions.map((function(e){return Object(F.jsx)(W,{title:Object(F.jsx)("b",{children:e.creatorid}),contentStyle:{whiteSpace:"pre"},children:e.content},e.id)}))})})},Ye=function(e){var t=e.children,n=e.style,r=Object(i.useRef)(null);return Object(i.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}),[]),Object(F.jsx)("div",{ref:r,style:Object(x.a)({},n),children:t})},_e=n(206),He=n(207),Je=n(208),qe=n(91),Ge=n(205),Xe=c.a.forwardRef((function(e,t){var n=e.anchor,r=e.show,i=e.menuItems;return Object(F.jsx)(qe.a,{ref:t,anchorEl:n,open:r,children:i.map((function(e,t){return Object(F.jsx)(Ge.a,{onClick:e.handler,children:e.content},t)}))})})),Ke=function(e){var t=e.menuItems,n=Object(i.useState)(!1),r=Object(s.a)(n,2),c=r[0],a=r[1],o=Object(i.useRef)(null);return Object(F.jsxs)("div",{style:{position:"relative",top:0,right:0,display:"flex",flexDirection:"row",alignSelf:"flex-start"},children:[Object(F.jsx)(_e.a,{onClickAway:function(){return a(!1)},children:Object(F.jsx)(He.a,{style:{padding:0},onClick:function(){return a(!0)},ref:o,children:Object(F.jsx)(Je.a,{})})}),Object(F.jsx)(Xe,{show:c,anchor:o.current,menuItems:t})]})},Qe=n(209),Ze=Object(g.a)({loadingModal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"}}),$e=function(e){var t=e.open,n=Ze();return Object(F.jsx)(Oe.a,{open:t,className:n.loadingModal,children:Object(F.jsx)(xe.a,{style:{outline:"none",display:"flex",justifyContent:"center"},children:Object(F.jsx)(Qe.a,{})})})},et=n(236),tt=n(210),nt=n(232),rt=n(211),it=function(e){var t=Object(i.useState)([0,null]),n=Object(s.a)(t,2),r=Object(s.a)(n[0],2),c=r[0],a=r[1],o=n[1],l=Object(i.useCallback)((function(){o([0,null])}),[o]),u=Object(i.useMemo)((function(){return c===e.length-1}),[c,e.length]);return{page:c,direction:a,goTo:function(t){return"next"===t&&c<e.length-1?o((function(e){return[Object(s.a)(e,1)[0]+1,"next"]})):"prev"===t&&c>0?o((function(e){return[Object(s.a)(e,1)[0]-1,"prev"]})):null},reset:l,lastPage:u}},ct=Object(g.a)({contentContainer:{paddingBottom:"32px",height:"40vh",display:"flex",flexDirection:"column"},instructionsContainer:{flexGrow:4},divider:{marginBottom:"16px"},centerVertically:{position:"relative",top:"50%",transform:"translateY(-50%)"},buttonsContainer:{display:"flex",justifyContent:"space-between"}}),at=function(e){var t=e.show,n=e.dismiss,r=e.title,c=e.steps,a=e.startButtonContent,o=it(c),s=o.page,l=o.goTo,u=o.reset,d=Object(i.useCallback)((function(){u(),n()}),[]),j=Object(i.useCallback)((function(){s===c.length-1?d():l("next")}),[s,l,d,c.length]),b=Object(i.useCallback)((function(){l("prev")}),[l]),h=ct();return Object(F.jsx)(ke,{header:r,open:t,exit:d,children:Object(F.jsxs)("div",{className:h.contentContainer,children:[Object(F.jsx)(et.a,{activeStep:s,children:c.map((function(e,t){return Object(F.jsx)(tt.a,{children:Object(F.jsx)(nt.a,{})},t)}))}),Object(F.jsxs)(p.a,{className:h.instructionsContainer,children:[Object(F.jsx)(D.a,{className:h.divider}),Object(F.jsx)("div",{className:h.centerVertically,children:Object(F.jsx)(P.a,{variant:"h5",children:c[s]})})]}),Object(F.jsxs)(p.a,{className:h.buttonsContainer,children:[0===s?Object(F.jsx)("div",{}):Object(F.jsxs)(Pe.a,{onClick:b,children:[Object(F.jsx)(De.a,{})," Previous"]}),Object(F.jsx)(Pe.a,{onClick:j,children:s===c.length-1?a:Object(F.jsxs)(F.Fragment,{children:["Next ",Object(F.jsx)(rt.a,{})]})})]})]})})},ot=function(e){var t=e.atExit,n=e.story_id,r=e.onboarding,c=de.useChunksState(),a=Object(s.a)(c,2),o=a[0],g=a[1];Object(i.useEffect)((function(){g((function(e){return e}))}),[g]);var m=ae(),y=m.progressState,T=m.playingState,M=m.duration,R=m.controller,B=m.playerRef,P=y.progress,D=y.setProgressWithVideoUpdate,I=Object(s.a)(T,2)[1],V=Object(i.useMemo)((function(){return function(e){return e.map((function(e){return{value:100*e.endtimeseconds}}))}(o)}),[o]),L=Object(i.useContext)(U).userName,z=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];return function(e){t((function(t){return e(t),t}))}}(),Y=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];return function(e){return t((function(t){return se(t.filter((function(t){return t.id!==e.id})),(function(e,t){return e.endtimeseconds!==t.starttimeseconds?Object(x.a)(Object(x.a)({},t),{},{starttimeseconds:e.endtimeseconds,starttimestamp:e.endtimestamp,id:Object(oe.a)(),updatedat:new Date,transcriptions:[]}):t})).concat((n=t.filter((function(t){return t.id!==e.id}))[0],n?0===n.starttimeseconds?[n]:[Object(x.a)(Object(x.a)({},n),{},{starttimeseconds:0,starttimestamp:"00:00:00:00",id:Object(oe.a)(),updatedat:new Date,transcriptions:[]})]:[])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}));var n}))}}(),_=function(e){return function(t,n,r){e((function(e){if(function(e,t,n){return 0===t||t>n||e.reduce((function(e,n){return e||n.endtimeseconds===t||n.starttimeseconds===t}),!1)}(e,t,n))return e;var i=w(e,t);return void 0!==i?e.filter((function(e){return e.id!==i.id})).concat([{starttimestamp:i.starttimestamp,starttimeseconds:i.starttimeseconds,endtimestamp:v(t*n),endtimeseconds:t,creatorid:r,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]},{starttimestamp:v(t*n),starttimeseconds:t,endtimestamp:i.endtimestamp,endtimeseconds:i.endtimeseconds,creatorid:r,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}]).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds})):e.concat([{starttimestamp:k(e),endtimestamp:v(t*n),starttimeseconds:C(e),endtimeseconds:t,creatorid:r,updatedat:new Date,id:Object(oe.a)(),transcriptions:[]}])}))}}(g),H=A(),J=Object(i.useState)(void 0),q=Object(s.a)(J,2),G=q[0],X=q[1];Object(i.useEffect)((function(){void 0!==G&&P>G.endtimeseconds&&(X(void 0),I(!1))}),[P,G,o,I]);var K=Object(i.useCallback)((function(e,t,n){(null===t||void 0===t?void 0:t.id)===e.id&&n?I(!1):(I(!0),X(e),D(e.starttimeseconds))}),[D,I]),Q=Object(i.useState)(void 0),Z=Object(s.a)(Q,2),$=Z[0],ee=Z[1],te=Ee((function(e,t,n,r){return _(t,n,r)}),(function(e,t){var n=w(e,t);return void 0!==n&&S(n)})),ne=te.attemptAction,re=Object(l.a)(te,["attemptAction"]),ie=Ee(Y,(function(e){return S(e)})),le=ie.attemptAction,ue=Object(l.a)(ie,["attemptAction"]),je=Object(i.useState)(void 0),be=Object(s.a)(je,2),he=be[0],fe=be[1],Oe=Object(i.useMemo)((function(){return{marginRight:"4px",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.8}}),[]),xe=Object(i.useRef)({backgroundColor:"green",height:"100%",padding:"16px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",color:"white"}),ge=Object(i.useRef)({margin:"8px",transform:"translateY(8px)",height:"calc(100% - 16px)"}),me=r.showOnboardingModal,ve=r.dismissOnboardingModal,ye=Object(i.useCallback)((function(){return X(void 0)}),[X]);return Object(F.jsxs)(h.a,{children:[Object(F.jsx)($e,{open:0===M}),Object(F.jsx)(p.a,{children:Object(F.jsx)("div",{className:H.backButtonContainer,children:Object(F.jsx)(We,{action:t})})}),Object(F.jsx)(at,{show:me,dismiss:ve,title:Object(F.jsx)("h2",{className:H.onboardingTitle,children:"Chunking Instructions"}),steps:["You are about to chunk the video. The aim of chunking is to make Transcribing easy.","Rather than transcribing the entire video at once, you will break the video down into smaller chunks, which you will transcribe individually.","You should aim to have only one person speaking in each chunk. Create a new chunk when there is a change in who is talking, there is a gap in the talking, or a person begins/ends talking.","To create a chunk, press the '+' button in the bottom right corner. The time that you press the '+' button in the video will be the end of the new chunk."],startButtonContent:Object(F.jsx)("div",{children:"Start Chunking"})}),Object(F.jsx)(Re,{story_id:n,chunk:$,exit:function(){return ee(void 0)},storyDuration:M}),Object(F.jsx)(ze,{actionControls:ue,warningMessage:Object(F.jsx)("div",{children:"This Chunk has a transcription"}),children:function(){return Object(F.jsxs)("div",{style:{overflowWrap:"anywhere"},children:["Attempting to delete chunk",(arguments.length<=0?void 0:arguments[0])&&' "'.concat(N(arguments.length<=0?void 0:arguments[0]),'"'),", which has a transcription saved to it. Are you sure you want to delete it?"]})}}),Object(F.jsx)(ze,{actionControls:re,warningMessage:Object(F.jsx)("div",{children:"The enclosing chunk has a transcription"}),children:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Object(F.jsxs)("div",{children:['Creating a new chunk here will delete the transcriptions on the enclosing chunk, "',N(null!==(e=w(n[0],n[1]))&&void 0!==e?e:n[0][0]),'". Are you sure you want to discard these transcriptions?']})}}),Object(F.jsx)(Ue,{chunk:he,exit:function(){return fe(void 0)}}),Object(F.jsx)("div",{className:H.videoPlayerContainer,children:Object(F.jsx)(ce,{controller:R,progressState:y,playerRef:B,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),sliderMarks:V,onProgressDrag:ye})}),Object(F.jsx)(f.a,{className:H.chunksList,cellHeight:"auto",cols:2.5,children:o.map((function(e){return Object(F.jsx)(O.a,{children:Object(F.jsx)(Ye,{children:Object(F.jsx)(E,{chunk:e,transcriptionIcon:Object(F.jsx)(Ke,{menuItems:[{content:"Delete",handler:function(){return function(e){z((function(t){t.forEach((function(t){return t.id===e.id&&le(t)}))}))}(e)}},{content:"Edit",handler:function(){return ee(e)}}].concat(0!==e.transcriptions.length?[{content:"View Transcriptions",handler:function(){return fe(e)}}]:[])}),children:Object(F.jsxs)("div",{className:H.chunkCardBody,children:[Object(F.jsx)(Be,{url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),time:e.starttimeseconds+(e.endtimeseconds-e.starttimeseconds)/2}),Object(F.jsx)(pe,{round:!0,color:"primary",style:Oe,onClick:function(){return K(e,G,T[0])},children:(null===G||void 0===G?void 0:G.id)===e.id&&T[0]?Object(F.jsx)(u.a,{}):Object(F.jsx)(d.a,{})})]})})})},e.id)})).concat(C(o)>.75?[Object(F.jsx)(O.a,{onClick:function(){1!==C(o)&&L&&_(1,M,L),t()},children:Object(F.jsx)(Ye,{style:{height:"100%"},children:Object(F.jsx)(W,{contentStyle:xe.current,cardStyle:ge.current,children:Object(F.jsx)(j.a,{fontSize:"large",style:{marginRight:"4px"}})})})},"Done Card")]:[])}),Object(F.jsx)("div",{children:Object(F.jsx)("div",{className:H.newChunkButtonContainer,children:Object(F.jsx)(pe,{round:!0,"aria-label":"New Chunk",style:{margin:"8px"},onClick:function(){L&&ne(o,P,M,L)},children:Object(F.jsx)(b.a,{})})})})]})},st=n(158);var lt,ut=function(e){return Object(F.jsxs)(h.a,{display:"flex",alignItems:"center",children:[Object(F.jsx)(h.a,{width:"100%",mr:1,children:Object(F.jsx)(st.a,Object(x.a)({variant:"determinate"},e))}),Object(F.jsx)(h.a,{minWidth:35,children:Object(F.jsx)(P.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},dt="#dddddd",jt=Object(g.a)({paper:{border:"1px solid ".concat(dt),borderTop:"0",borderTopRightRadius:"0",borderTopLeftRadius:"0",padding:"15px"},stepHeader:{padding:"4px",backgroundColor:"#f5f5f5",border:"1px solid ".concat(dt),borderBottomRightRadius:"0",borderBottomLeftRadius:"0"},button:{marginTop:"16px"}}),bt=function(e){var t=e.title,n=e.description,r=e.progress,i=e.onSelect,c=e.enabled,a=jt();return Object(F.jsxs)("div",{children:[Object(F.jsx)(ve,{children:Object(F.jsxs)("div",{className:a.stepHeader,children:[Object(F.jsx)(P.a,{variant:"subtitle1",children:t}),Object(F.jsx)(ut,{value:r})]})}),Object(F.jsx)(ve,{children:Object(F.jsxs)("div",{className:a.paper,children:[n,Object(F.jsx)("br",{}),Object(F.jsx)(h.a,{style:{marginTop:"8px"},children:Object(F.jsx)(pe,{disabled:!c,onClick:i,children:Object(F.jsxs)(P.a,{style:{padding:"6px"},children:["Perform ",t]})})})]})})]})},ht=Object(g.a)({introContainer:{textAlign:"center"},transcriberModal:{display:"flex",flexDirection:"column"}}),pt=n(235),ft=c.a.forwardRef((function(e,t){var n=e.placeholder,r=e.buttonText,c=e.classes,a=e.onSubmit,o=Object(i.useState)(null),l=Object(s.a)(o,2),u=l[0],d=l[1];return Object(F.jsxs)("div",{ref:t,children:[Object(F.jsx)(pt.a,{className:c.input,onChange:function(e){return d(e.target.value)},placeholder:n}),Object(F.jsx)(pe,{onClick:function(){return u&&a(u)},styles:{height:"3rem",borderRadius:"0px 8px 8px 0px"},children:Object(F.jsx)(P.a,{variant:"subtitle1",children:r})})]})})),Ot=Object(g.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"},input:{flex:1,width:"400px",height:"3rem",border:"1px solid #cccccc",paddingLeft:"8px",borderRadius:"8px 0px 0px 8px"}}),xt=function(e){var t=e.show,n=e.setName,r=Ot();return Object(F.jsx)(ke,{open:t,children:Object(F.jsxs)("div",{children:[Object(F.jsx)(P.a,{variant:"subtitle1",children:"Please enter your name before performing transcription:"}),Object(F.jsx)(ft,{placeholder:"my name",buttonText:"Perform Transcription",classes:r,onSubmit:n})]})})},gt=n(217),mt=Object(g.a)({indabaLink:{color:"#d9534f",cursor:"pointer"}}),vt=c.a.forwardRef((function(e,t){var n=e.children,r=Object(l.a)(e,["children"]),i=mt();return Object(F.jsx)(gt.a,Object(x.a)(Object(x.a)({ref:t,className:i.indabaLink},r),{},{children:n}))})),yt=function(e){var t=e.name;return Object(F.jsx)(P.a,{style:{fontWeight:"lighter",overflowWrap:"anywhere"},variant:"h5",children:t&&"Hello ".concat(t)})},kt=function(e){var t=e.storyName;return Object(F.jsxs)(P.a,{variant:"h3",style:{color:"gray",fontWeight:"lighter"},children:["Field Transcription for"," ",Object(F.jsx)(h.a,{component:"span",style:{color:"black"},children:t})]})},Ct=function(e){var t=e.storyName,n=e.steps,r=e.logOutAction,c=Object(i.useContext)(U),a=c.userName,o=c.setName,s=c.clearName,l=ht();return Object(F.jsxs)(p.a,{children:[Object(F.jsx)(xt,{setName:o,show:!a}),Object(F.jsxs)(p.a,{className:l.introContainer,children:[Object(F.jsx)(kt,{storyName:t}),Object(F.jsx)(yt,{name:a}),a&&Object(F.jsx)(vt,{onClick:function(){s(),r()},children:"This is not me!"})]}),Object(F.jsx)("div",{style:{marginBottom:"16px"},children:"There are 3 stages to transcribing, select which stage you are performing"}),Object(F.jsx)(h.a,{children:Object(F.jsx)(f.a,{cols:3,cellHeight:"auto",spacing:20,children:n.map((function(e){return Object(F.jsx)(O.a,{children:Object(F.jsx)(bt,Object(x.a)({},e))},e.title)}))})})]})},wt=Object(g.a)({buildVersion:{fontFamily:"Open Sans",color:"#7a7a7a",fontWeight:"bold",fontSize:"19px",position:"absolute",paddingTop:"10px",top:"-5px",left:"122px"},titleRow:{marginTop:"5px",display:"flex",flexDirection:"row",height:"48px",position:"relative"},logoContainer:{position:"relative",paddingTop:"6px",width:"25%"},titleContainer:{width:"50%",height:"48px",marginTop:"10px",paddingLeft:"15px",paddingRight:"15px",textAlign:"center"},titleWrapper:{fontSize:"13pt",margin:"3px",display:"inline-block"},contextMenuButton:{position:"absolute",right:0}}),St=n.p+"static/media/logo_web.d3de7844.svg",Tt=function(e){var t=e.children,n=e.title,r=e.contextMenuItems,c=e.hidden,a=wt(),o=Object(i.useRef)(null),l=V(!1),u=Object(s.a)(l,3),d=u[0],j=u[1],b=u[2];return Object(F.jsx)(F.Fragment,{children:Object(F.jsxs)(p.a,{style:{height:"calc(100vh - 5px)",width:"100%",padding:0,marginTop:"5px",display:"flex",flexDirection:"column"},children:[c?null:Object(F.jsxs)(p.a,{children:[Object(F.jsxs)("div",{className:a.titleRow,children:[Object(F.jsxs)("div",{className:a.logoContainer,children:[Object(F.jsx)("img",{src:St,alt:"logo",width:"120px",height:"36px"}),Object(F.jsx)("span",{className:a.buildVersion,children:"TITAN"})]}),Object(F.jsx)("div",{className:a.titleContainer,children:Object(F.jsx)("div",{className:a.titleWrapper,children:n})}),Object(F.jsx)(_e.a,{onClickAway:function(){return b(!1)},children:Object(F.jsx)(He.a,{className:a.contextMenuButton,onClick:j,ref:o,children:Object(F.jsx)(Je.a,{})})}),Object(F.jsx)(Xe,{show:d,anchor:o.current,menuItems:r})]}),Object(F.jsx)(D.a,{})]}),t]})})};!function(e){e[e.Dashboard=0]="Dashboard",e[e.Chunking=1]="Chunking",e[e.Transcribing=2]="Transcribing",e[e.Reviewing=3]="Reviewing"}(lt||(lt={}));var Mt=lt,Nt=function(e,t){return Object(i.useMemo)((function(){return[{title:"Chunking",description:"We need to know when people are talking in the story, so that we can transcribe them.",progress:t[0].progress,onSelect:function(){return e(Mt.Chunking)},enabled:t[0].enabled},{title:"Transcription",description:"Writing down exactly what is said in each chunk of the story.",progress:t[1].progress,onSelect:function(){return e(Mt.Transcribing)},enabled:t[1].enabled},{title:"Review",description:"Reviewing content is key to making sure we represent participants authentically.",progress:t[2].progress,onSelect:function(){return e(Mt.Reviewing)},enabled:t[2].enabled}]}),[e,t])},Rt=n(221),Bt=n(222),Pt=n(223),Dt="8px",Ft=Object(g.a)({videoPlayerContainer:{position:"relative",overflow:"hidden"},inputField:{width:"100%"},chunkProgressRail:{height:Dt,color:"#d9534f"},chunkProgressTrack:{height:Dt,color:"#d9534f"},chunkProgressMark:{height:Dt,width:"4px",backgroundColor:"#FFFFFF",opacity:.8},stepperDots:{backgroundColor:"#d9534f"},stepperDotsContainer:{flexWrap:"wrap"},stepperDot:{margin:"2px"}}),Wt=n(218),It=n(219),Et=n(220),At=Object(g.a)({slideshowContainer:{display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"flex-end",width:"100%"},slideshowContentContainer:{flexGrow:4}}),Vt=function(e){var t=e.onNavigate,n=e.onComplete,r=e.currentPage,i=e.numberOfPages,c=e.children,a=e.style,o=e.contentContainerStyle,s=e.leftColumn,l=e.rightColumn,u=At();return Object(F.jsxs)("div",{className:u.slideshowContainer,style:a,children:[null!==s&&void 0!==s?s:Object(F.jsx)(pe,{round:!0,"aria-label":"Previous",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:0===r,onClick:function(){return t("prev")},children:Object(F.jsx)(Wt.a,{})}),Object(F.jsx)(h.a,{style:Object(x.a)({},o),className:u.slideshowContentContainer,children:c}),null!==l&&void 0!==l?l:n&&r===i-1?Object(F.jsx)(pe,{round:!0,"aria-label":"Complete",style:{color:"#FFFFFF",backgroundColor:"#40bf11",alignSelf:"flex-start",marginTop:"32px"},onClick:n,children:Object(F.jsx)(It.a,{})}):Object(F.jsx)(pe,{round:!0,"aria-label":"Next",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:r===i-1,onClick:function(){return t("next")},children:Object(F.jsx)(Et.a,{})})]})},Lt=function(e){var t=e.inputRef,n=e.transcriptionValue,r=e.transcriptionIcon,i=e.onChange;return Object(F.jsx)(W,{title:r,cardStyle:{margin:"16px 8px 0 8px"},children:Object(F.jsx)(fe.a,{autoFocus:!0,multiline:!0,rows:7,inputRef:t,style:{width:"100%"},variant:"outlined",label:"Transcription",value:n,onChange:function(e){i(e.target.value)}})})},zt=function(e,t){return le(e.transcriptions,(function(e){return e.creatorid===t}))?e.transcriptions.filter((function(e){return e.creatorid===t}))[0]:void 0},Ut=function(e,t){for(var n=[],r=e.starttimeseconds+4/t;r<e.endtimeseconds;)n.push(r),r+=5/t;return r!==e.endtimeseconds&&n.push(e.endtimeseconds),n},Yt=function(e,t){var n=e+1/t;return n>t?t:n},_t=function(e,t,n,r,c,a,o){var s=Object(i.useCallback)((function(n,r,i,o){var s,l,u=(s=r[i-1],l=e[n],null!==s&&void 0!==s?s:l.starttimeseconds);return a(u),c({start:u,end:Yt(r[i],t)}),{miniChunks:r,currentChunk:n,currentMiniChunk:i,transcription:o}}),[a,c,e,t]);return Object(i.useCallback)((function(i,c){var a,l;switch(r&&["go to next page","go to previous page","flush transcription changes"].includes(c.actionType)&&n(e[i.currentChunk],i.transcription,r),c.actionType){case"go to next page":if(i.currentMiniChunk===i.miniChunks.length-1&&i.currentChunk<e.length-1){var u,d,j=i.currentChunk+1;return s(j,Ut(e[j],t),0,null!==(u=null===(d=zt(e[j],null!==r&&void 0!==r?r:""))||void 0===d?void 0:d.content)&&void 0!==u?u:"")}if(i.currentMiniChunk<i.miniChunks.length-1)return s(i.currentChunk,i.miniChunks,i.currentMiniChunk+1,i.transcription);o();break;case"go to previous page":if(0===i.currentMiniChunk&&i.currentChunk>0){var b,h,p=i.currentChunk-1,f=Ut(e[p],t);return s(p,f,f.length-1,null!==(b=null===(h=zt(e[p],null!==r&&void 0!==r?r:""))||void 0===h?void 0:h.content)&&void 0!==b?b:"")}if(i.currentMiniChunk>0)return s(i.currentChunk,i.miniChunks,i.currentMiniChunk-1,i.transcription);break;case"transcription changed":return void 0!==c.newTranscription?Object(x.a)(Object(x.a)({},i),{},{transcription:c.newTranscription}):Object(x.a)({},i);case"go to first mini chunk":return s(i.currentChunk,i.miniChunks,0,i.transcription),Object(x.a)(Object(x.a)({},i),{},{currentMiniChunk:0});case"go to last mini chunk":var O=i.miniChunks.length-1;return s(i.currentChunk,i.miniChunks,O,i.transcription),Object(x.a)(Object(x.a)({},i),{},{currentMiniChunk:O});case"refresh mini chunks":var g=Ut(e[i.currentChunk],t);return s(i.currentChunk,g,0,i.transcription),Object(x.a)(Object(x.a)({},i),{},{currentMiniChunk:0,miniChunks:g,transcription:null!==(a=null===(l=zt(e[i.currentChunk],null!==r&&void 0!==r?r:""))||void 0===l?void 0:l.content)&&void 0!==a?a:""})}return i}),[e,t,n,r,o,s])},Ht=n(88),Jt=function(e,t){var n=Object(i.useState)(!1),r=Object(s.a)(n,2)[1],c=Object(i.useState)(!1),a=Object(s.a)(c,2),o=a[0],l=a[1],u=Object(Ht.a)((function(){t(o),r(!1)}),500);return Object(i.useCallback)((function(){r((function(t){return t||l(e),!0})),u(),t(!1)}),[e,t,u])},qt=function(){return Object(F.jsx)("div",{})},Gt=function(e){var t=e.story_id,n=e.atExit,r=e.onboarding,c=de.useChunksState(),a=Object(s.a)(c,1)[0],o=r.showOnboardingModal,l=r.dismissOnboardingModal,u=ae(),d=u.progressState,b=u.playerRef,f=Object(s.a)(u.splitState,2),O=f[0],x=f[1],g=u.duration,m=u.controller,v=Object(s.a)(u.playingState,2),k=v[0],C=v[1],w=je(),S=Object(i.useContext)(U).userName,T=d.setProgressWithVideoUpdate,M=_t(a,g,w,S,x,T,n),R=Object(i.useReducer)(M,{currentChunk:0,currentMiniChunk:0,miniChunks:[],transcription:""}),B=Object(s.a)(R,2),P=B[0],D=B[1];Object(i.useEffect)((function(){0!==g&&D({actionType:"refresh mini chunks"})}),[g]);var W=Object(i.useMemo)((function(){return P.currentChunk===a.length-1&&P.currentMiniChunk===P.miniChunks.length-1}),[P.currentChunk,P.currentMiniChunk,P.miniChunks,a]),I=Ft(),E=Object(i.useRef)(null);Object(i.useEffect)((function(){(E.current?E.current:{focus:function(){return null}}).focus()}),[k,P.currentChunk,P.currentMiniChunk]);var A=function(){D({actionType:"flush transcription changes"}),n()},V=Jt(k,C);return Object(F.jsxs)("div",{children:[Object(F.jsx)($e,{open:0===g}),Object(F.jsx)(p.a,{style:{marginBottom:"4px"},children:Object(F.jsx)(We,{action:A})}),Object(F.jsx)(at,{show:o,dismiss:l,title:Object(F.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),steps:["You are about to Transcribe the chunks.","Each chunk has been divided into 5 second clips for you. These clips will loop.","When you type, the video will pause until you stop typing",'When you are done transcribing a clip press the ">" button'],startButtonContent:Object(F.jsx)("div",{children:"Start Transcribing"})}),a.length&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(h.a,{className:I.videoPlayerContainer,children:Object(F.jsx)(ce,{progressState:d,playerRef:b,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(t),controller:m,loop:!0})}),Object(F.jsxs)("div",{style:{margin:"0 8px 0 8px"},children:[Object(F.jsx)(Rt.a,{variant:"dots",steps:P.miniChunks.length,activeStep:P.currentMiniChunk,position:"static",classes:{dotActive:I.stepperDots,dots:I.stepperDotsContainer,dot:I.stepperDot},nextButton:Object(F.jsx)(_.a,{onClick:function(){return D({actionType:"go to last mini chunk"})},children:"Last"}),backButton:Object(F.jsx)(_.a,{onClick:function(){return D({actionType:"go to first mini chunk"})},children:"First"})}),Object(F.jsx)(Vt,{currentPage:P.currentChunk,onNavigate:function(){return null},numberOfPages:a.length,onComplete:A,leftColumn:Object(F.jsx)("div",{children:Object(F.jsx)(pe,{onClick:function(){return D({actionType:"go to previous page"})},children:Object(F.jsx)(Bt.a,{})})}),rightColumn:Object(F.jsx)("div",{children:Object(F.jsx)(pe,{style:{backgroundColor:W?"green":"#d9534f"},onClick:function(){return D({actionType:"go to next page"})},children:W?Object(F.jsx)(j.a,{}):Object(F.jsx)(Pt.a,{})})}),children:Object(F.jsx)(Lt,{transcriptionIcon:Object(F.jsxs)("div",{style:{display:"flex",flexDirection:"column",margin:"0 8px 0 8px"},children:[Object(F.jsx)("span",{style:{fontWeight:600,overflowWrap:"anywhere"},children:N(a[P.currentChunk])}),Object(F.jsx)(Q.a,{ThumbComponent:qt,value:[100*a[P.currentChunk].starttimeseconds,100*a[P.currentChunk].endtimeseconds],classes:{rail:I.chunkProgressRail,track:I.chunkProgressTrack,mark:I.chunkProgressMark,markActive:I.chunkProgressMark},marks:[{value:100*O.start,label:y(P.miniChunks[P.currentMiniChunk]*g)}]})]}),inputRef:E,transcriptionValue:P.transcription,onChange:function(e){V(),D({actionType:"transcription changed",newTranscription:e})}})})]})]}),Object(F.jsx)("div",{style:{position:"absolute",left:0,bottom:0,width:"100%"},children:!1})]})},Xt=n(65),Kt=n.n(Xt),Qt=n(89),Zt=n(62),$t=n.n(Zt),en=function(e,t){var n="http://".concat(we,":8845/api/watch/savedit/").concat(t,"?apikey=").concat(Se);$t.a.request({url:n,method:"POST",withCredentials:!0,data:e})},tn=function(e){var t,n=Object(i.useState)(void 0),r=Object(s.a)(n,2),c=r[0],a=r[1],o=Object(i.useMemo)((function(){var e;return null!==(e=null===c||void 0===c?void 0:c.transcription.chunks)&&void 0!==e?e:[]}),[null===c||void 0===c||null===(t=c.transcription)||void 0===t?void 0:t.chunks]),l=Object(i.useCallback)(function(){var t=Object(Qt.a)(Kt.a.mark((function t(n){var r;return Kt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n,t.next=3,$t.a.request({withCredentials:!0,url:"http://".concat(we,":8845/api/watch/edit/").concat(e),transformResponse:function(e){var t,n,r;return null!==(t=null===(n=JSON.parse(e))||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[]}});case 3:t.t1=t.sent.data,r=(0,t.t0)(t.t1),a((function(t){var n=void 0===t?void 0:Object(x.a)(Object(x.a)({},t),{},{transcription:{chunks:r}});return n&&en(n,e),n}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]);Object(i.useEffect)((function(){$t.a.request({url:"http://".concat(we,":8845/api/watch/edit/").concat(e),withCredentials:!0,transformResponse:function(e){return JSON.parse(e)}}).then((function(e){var t,n,r,i;a(e.data),i=null!==(t=null===(n=e.data)||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[],a((function(e){return void 0===e?void 0:Object(x.a)(Object(x.a)({},e),{},{transcription:{chunks:i}})}))}))}),[e]);var u=Object(i.useMemo)((function(){return[o,l]}),[o,l]);return{storyTitle:c&&c.title,chunksState:u}},nn=n(201),rn=n(157),cn=n(228),an=n(224),on=n(225),sn=Object(g.a)({doneButton:{backgroundColor:"green",color:"white"},cardContainer:{marginTop:"8px",marginBottom:"8px",padding:"0 8px 0 8px",width:"100%"}}),ln=function(e){var t=e.atExit,n=e.story_id,r=e.onboarding,c=r.showOnboardingModal,a=r.dismissOnboardingModal,o=ae(),l=o.progressState,u=Object(s.a)(o.splitState,2)[1],d=o.controller,b=o.playerRef,f=o.duration,O=l.setProgressWithVideoUpdate,g=de.useChunksState(),m=Object(s.a)(g,1)[0],v=sn(),y=m.filter(S),k=it(y),C=k.page,w=k.goTo,T=k.lastPage,M=Object(i.useMemo)((function(){return y[C]}),[C,y]);Object(i.useEffect)((function(){u({start:M.starttimeseconds,end:M.endtimeseconds}),O(M.starttimeseconds)}),[C,m,M,O,u]);var N=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];return function(e,n,r){t((function(t){return t.map((function(t){return t.id===e.id&&le(t.transcriptions,(function(e){return e.id===n.id}))?Object(x.a)(Object(x.a)({},t),{},{review:{reviewedat:new Date,selectedtranscription:n.id,reviewedby:r}}):t}))}))}}(),R=function(){var e=de.useChunksState(),t=Object(s.a)(e,2)[1];return function(e){t((function(t){return t.map((function(t){return t.id===e.id?Object(x.a)(Object(x.a)({},t),{},{review:void 0}):t}))}))}}(),B=Object(i.useContext)(U).userName,W=Object(i.useState)(""),I=Object(s.a)(W,2),A=I[0],V=I[1],L=Object(i.useState)(void 0),z=Object(s.a)(L,2),Y=z[0],_=z[1];Object(i.useEffect)((function(){V(Y?Y.content:"")}),[Y]);var H=je();return Object(F.jsxs)("div",{children:[Object(F.jsx)($e,{open:0===f}),Object(F.jsx)(p.a,{style:{marginTop:"4px"},children:Object(F.jsx)(We,{action:t})}),Object(F.jsx)(at,{show:c,dismiss:a,steps:["You are about to review the transcriptions made on the video.","For each chunk, select one of the transcriptions from the list. You can do this by clicking on the text or the check box to the left of the text.","You can also edit the transcriptions by clicking on the pencil button above the text."],title:Object(F.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),startButtonContent:Object(F.jsx)("div",{children:"Start Reviewing"})}),Object(F.jsx)(ke,{open:void 0!==Y,header:Object(F.jsx)(Le,{message:Object(F.jsxs)("div",{style:{whiteSpace:"pre"},children:["You Are Editing"," ",Object(F.jsx)("span",{style:{textDecoration:"underline"},children:"".concat(null===Y||void 0===Y?void 0:Y.creatorid)}),"'s Transcription"]})}),exit:function(){_(void 0)},children:Object(F.jsxs)("div",{style:{position:"relative"},children:[Object(F.jsx)(nn.a,{style:{maxHeight:"300px",overflow:"scroll"},children:M.transcriptions.filter((function(e){return e.id!==(null===Y||void 0===Y?void 0:Y.id)})).map((function(e){return Object(F.jsxs)(rn.a,{style:{display:"flex"},children:[Object(F.jsxs)("span",{style:{alignSelf:"flex-start",fontWeight:600,whiteSpace:"pre"},children:[e.creatorid,":"," "]}),Object(F.jsx)("div",{style:{whiteSpace:"pre",overflowWrap:"anywhere"},children:e.content})]})}))}),Object(F.jsx)(Lt,{transcriptionValue:A,onChange:V}),Object(F.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(F.jsxs)(pe,{onClick:function(){Y&&H(M,A,Y.creatorid),_(void 0)},style:{margin:"8px",backgroundColor:"#40bf11",position:"relative",bottom:0,right:0},disabled:""===A,children:[Object(F.jsx)(It.a,{}),Object(F.jsx)("span",{style:{marginLeft:"4px",fontSize:"1.05rem"},children:"Complete"})]})})]})}),Object(F.jsx)(h.a,{children:Object(F.jsx)(ce,{playerRef:b,progressState:l,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),controller:d})}),Object(F.jsx)(p.a,{children:Object(F.jsx)(Vt,{currentPage:C,onNavigate:w,numberOfPages:y.length,onComplete:t,style:{width:"100%"},contentContainerStyle:{margin:"0 64px 0 64px"},leftColumn:Object(F.jsx)("div",{style:{position:"fixed",bottom:0,left:0,margin:"16px",zIndex:1},children:Object(F.jsx)(pe,{onClick:function(){return w("prev")},children:Object(F.jsx)(Bt.a,{})})}),rightColumn:Object(F.jsx)("div",{style:{position:"fixed",bottom:0,right:0,margin:"16px",zIndex:1},children:Object(F.jsx)(pe,{onClick:function(){return T?t():w("next")},style:{backgroundColor:T?"green":"#d9534f"},children:T?Object(F.jsx)(j.a,{}):Object(F.jsx)(Pt.a,{})})}),children:Object(F.jsx)(E,{chunk:M,children:M.transcriptions.map((function(e){var t;return e.content&&Object(F.jsxs)(h.a,{className:v.cardContainer,children:[Object(F.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(F.jsxs)("div",{style:{fontSize:"1.2rem",display:"flex",justifyContent:"center",paddingLeft:"10px"},children:[Object(F.jsx)(an.a,{}),Object(F.jsx)("div",{style:{marginLeft:"4px",overflowWrap:"anywhere"},children:e.creatorid})]}),Object(F.jsx)(pe,{onClick:function(){return _(e)},style:{padding:"0px",height:"32px",width:"32px",minWidth:"32px"},children:Object(F.jsx)(on.a,{fontSize:"small"})})]}),Object(F.jsxs)("div",{onClick:function(){var t;return B&&((null===(t=M.review)||void 0===t?void 0:t.selectedtranscription)!==e.id?N(M,e,B):R(M))},style:{display:"flex",flexDirection:"row"},children:[Object(F.jsx)(cn.a,{checked:(null===(t=M.review)||void 0===t?void 0:t.selectedtranscription)===e.id,onChange:function(t,n){return B&&(n?N(M,e,B):R(M))},style:{backgroundColor:"initial"}}),Object(F.jsx)(P.a,{variant:"h6",style:{padding:"8px",overflowWrap:"anywhere",whiteSpace:"pre"},children:e.content})]}),Object(F.jsx)(D.a,{style:{margin:"16px 0 16px 0"}})]},e.id)}))})})})]})},un=n(90),dn=[["year",31536e3],["month",2592e3],["day",86400],["hour",3600],["minute",60],["second",1]],jn=function(e){var t=function(e){var t,n=Object(un.a)(dn);try{for(n.s();!(t=n.n()).done;){var r=Object(s.a)(t.value,2),i=r[0],c=r[1],a=Math.floor(e/+c);if(a>=1)return{interval:a,epoch:i}}}catch(o){n.e(o)}finally{n.f()}return{interval:0,epoch:"second"}}(Math.floor((+new Date-+new Date(e))/1e3)),n=t.interval,r=t.epoch,i=1===n?"":"s";return"second"===r?"Less than a minute ago":"".concat(n," ").concat(r).concat(i," ago")},bn=function(e){var t,n,r,i,c=e.contribution,a=c.type,o=c.name,s=c.chunk;return Object(F.jsxs)("span",{style:{display:"flex",flexWrap:"wrap"},children:[Object(F.jsxs)("div",{style:{whiteSpace:"pre"},children:[Object(F.jsx)("span",{style:{fontWeight:"bold"},children:function(e){switch(e){case"chunk":return"Created ";case"transcription":return"Transcribed ";case"review":return"Reviewed "}}(a)}),"the chunk "]}),Object(F.jsxs)("div",{style:{overflowWrap:"anywhere"},children:['"',N(s),'"']})," (","".concat(y(M(T(s.starttimestamp)))," - ").concat(y(M(T(s.endtimestamp)))),")",Object(F.jsx)(P.a,{variant:"subtitle2",style:{marginLeft:"4px",fontWeight:600},children:jn("chunk"===a?s.updatedat:"transcription"===a?null!==(t=null===(n=zt(s,o))||void 0===n?void 0:n.updatedat)&&void 0!==t?t:new Date:null!==(r=null===(i=s.review)||void 0===i?void 0:i.reviewedat)&&void 0!==r?r:new Date)})]})},hn=function(e){var t=e.show,n=e.exit,r=e.chunks,c=Object(i.useMemo)((function(){return Array.from(function(e){return e.map((function(e){return{name:e.creatorid,type:"chunk",chunk:e}})).concat(e.reduce((function(e,t){return e.concat(t.transcriptions.map((function(e){return{name:e.creatorid,type:"transcription",chunk:t}})))}),[])).concat(e.reduce((function(e,t){return t.review?e.concat([{name:t.review.reviewedby,type:"review",chunk:t}]):e}),[]))}(r).reduce((function(e,t){return e.get(t.name)?e.set(t.name,e.get(t.name).concat([t])):e.set(t.name,[t])}),new Map))}),[r]);return Object(F.jsx)(ke,{header:Object(F.jsx)(P.a,{variant:"h3",style:{fontWeight:"lighter"},children:"Contributions"}),open:t,exit:n,children:Object(F.jsx)(ve,{children:Object(F.jsx)(p.a,{style:{height:"80vh",width:"90vw",overflow:"scroll"},children:Object(F.jsx)(f.a,{cols:1,cellHeight:"auto",children:c.map((function(e){return Object(F.jsx)(O.a,{children:Object(F.jsx)(W,{title:Object(F.jsx)("div",{style:{overflowWrap:"anywhere"},children:e[0]}),children:Object(F.jsx)(nn.a,{children:e[1].map((function(e){return Object(F.jsx)(rn.a,{children:Object(F.jsx)(bn,{contribution:e})},"".concat(e.chunk.id).concat(e.type))}))})})},e[0])}))})})})})},pn=function(){var e=Object(i.useState)(Mt.Dashboard),t=Object(s.a)(e,2),n=t[0],r=t[1],c=de.ChunksProvider,a=function(){var e=Object(i.useState)(""),t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(i.useEffect)((function(){r(window.location.href.split("/")[4].split("?")[0])}),[]),n}(),o=tn(a),l=o.storyTitle,u=Object(s.a)(o.chunksState,2),d=u[0],j=u[1],b=Object(i.useMemo)((function(){return C(d)}),[d]),h=Object(i.useMemo)((function(){return d.length?function(e){return e.reduce((function(e,t){return e+(S(t)?1:0)}),0)}(d)/d.length:0}),[d]),p=Object(i.useMemo)((function(){return d.length?function(e){return e.reduce((function(e,t){return e+(t.review?1:0)}),0)}(d)/d.length:0}),[d]),f=Nt(r,[{progress:100*b,enabled:!0},{progress:100*h,enabled:b>0},{progress:100*p,enabled:h>0}]),O=V(!1),x=Object(s.a)(O,2),g=x[0],m=x[1],v=L("showChunkEditorOnboardingModal","true"),y=Object(s.a)(v,2),k=y[0],w=y[1],T=L("showTranscriberOnboardingModal","true"),M=Object(s.a)(T,2),N=M[0],R=M[1],B=L("showReviewerOnboardingModal","true"),P=Object(s.a)(B,2),D=P[0],W=P[1],I=Object(i.useCallback)((function(){return r(Mt.Dashboard)}),[]),E=Object(i.useMemo)((function(){return[{content:Object(F.jsx)("div",{children:"Show Contributions"}),handler:m}].concat(n===Mt.Chunking?{content:Object(F.jsx)("div",{children:"View instructions"}),handler:function(){w("true")}}:n===Mt.Reviewing?{content:Object(F.jsx)("div",{children:"View instructions"}),handler:function(){W("true")}}:[])}),[n,w,W,m]);return Object(F.jsx)(c,{state:[d,j],children:Object(F.jsx)(Y,{children:Object(F.jsxs)("main",{children:[Object(F.jsx)(hn,{chunks:d,show:g,exit:m}),Object(F.jsx)(Tt,{title:Mt[n],hidden:n===Mt.Transcribing,contextMenuItems:E,children:n===Mt.Dashboard?Object(F.jsx)(Ct,{steps:f,storyName:l||"Loading",logOutAction:function(){w("true"),R("true"),W("true")}}):n===Mt.Chunking?Object(F.jsx)(ot,{story_id:a,atExit:I,onboarding:{showOnboardingModal:"true"===k,dismissOnboardingModal:function(){return w("false")}}}):n===Mt.Transcribing?Object(F.jsx)(Gt,{story_id:a,atExit:I,onboarding:{showOnboardingModal:"true"===N,dismissOnboardingModal:function(){return R("false")}}}):n===Mt.Reviewing?Object(F.jsx)(ln,{atExit:I,story_id:a,onboarding:{showOnboardingModal:"true"===D,dismissOnboardingModal:function(){return W("false")}}}):null})]})})})},fn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,238)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),c(e),a(e)}))};o.a.render(Object(F.jsx)(c.a.StrictMode,{children:Object(F.jsx)(pn,{})}),document.getElementById("root")),fn()}},[[154,1,2]]]);
//# sourceMappingURL=main.5e5a6a37.chunk.js.map