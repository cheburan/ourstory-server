(this.webpackJsonptranscription=this.webpackJsonptranscription||[]).push([[0],{110:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),c=n(15),a=n.n(c),o=(n(110),n(6)),s=n(30),l=n(214),u=n(196),d=n(215),j=n(216),b=n(226),h=n(199),p=n(212),f=n(213),O=n(7),x=n(191),g=function(e){return(t=Math.floor(e))<10?"0".concat(t<0?0:t):t.toString();var t},m=function(e){return"".concat(g(e/3600),":").concat(g(e/60),":").concat(g(e%60),":").concat(g(Math.round(100*(e-Math.floor(e)))))},v=function(e){return e>3600?m(e).substring(0,8):m(e).substring(3,8)},y=function(e){return e.length>0?e[e.length-1].endtimestamp:"00:00:00:00"},k=function(e){return e.length>0?e[e.length-1].endtimeseconds:0},C=function(e,t){for(var n=0;n<e.length;n++)if(t>e[n].starttimeseconds&&t<e[n].endtimeseconds)return e[n]},w=function(e){return e.transcriptions.reduce((function(e,t){return e||""!==t.content}),!1)},S=function(e){return{hours:Number(e.slice(0,2)),minutes:Number(e.slice(3,5)),seconds:Number(e.slice(6,8)),milliseconds:Number(e.slice(9,11))}},T=function(e){return 60*e.hours*60+60*e.minutes+e.seconds},M=function(e){return e.name?e.name:"".concat(T(S(e.endtimestamp))-T(S(e.starttimestamp))," second chunk")},N=n(186),R=n(189),B=n(156),P=n(190),D=n(1),F=function(e){var t=e.title,n=e.children,r=e.contentStyle,i=e.cardStyle;return Object(D.jsx)(N.a,{variant:"outlined",style:Object(O.a)({},i),children:Object(D.jsxs)(R.a,{style:Object(O.a)({},r),children:[Object(D.jsx)(B.a,{variant:"h5",component:"h2",children:t}),t?Object(D.jsx)(P.a,{style:{margin:"16px 0 16px 0"}}):null,n]})})},W=Object(x.a)({titleContainer:{fontSize:"1.2rem",position:"relative"}}),I=function(e){var t=e.chunk,n=e.children,r=e.style,i=e.transcriptionIcon,c=W(),a=function(e){return{start:S(e.starttimestamp),end:S(e.endtimestamp)}}(t),o=T(a.end),s=T(a.start);return Object(D.jsx)(F,{title:Object(D.jsx)("div",{children:Object(D.jsxs)("span",{className:c.titleContainer,style:{display:"flex",flexDirection:"column"},children:[Object(D.jsxs)("span",{style:{fontWeight:600,overflowWrap:"anywhere",display:"flex",justifyContent:"space-between"},children:[M(t),i]}),"".concat(v(s)," - ").concat(v(o))]})}),cardStyle:Object(O.a)(Object(O.a)({},r),{},{position:"relative",margin:"8px"}),children:n})},E=Object(x.a)({videoPlayerContainer:{margin:"auto"},actionButton:{"&:hover":{background:"#d9534f"}},chunksList:{flexWrap:"nowrap"},backButton:{background:"transparent",color:"black",fontSize:"16px"},backButtonContainer:{marginTop:"4px"},onboardingTitle:{margin:0},chunkCardBody:{marginTop:"8px",position:"relative"},newChunkButtonContainer:{position:"absolute",right:0,bottom:0,margin:"16px 16px 32px 16px",display:"flex"}}),A=function(e){var t=Object(r.useState)(e),n=Object(o.a)(t,2),i=n[0],c=n[1];return[i,function(){return c((function(e){return!e}))},c]},V=function(e,t){var n,i=Object(r.useState)(null!==(n=window.localStorage.getItem(e))&&void 0!==n?n:t),c=Object(o.a)(i,2),a=c[0],s=c[1],l=A(!1),u=Object(o.a)(l,2),d=u[0],j=u[1];if(!d){var b=window.localStorage.getItem(e);j(),b&&s(b)}return[a,Object(r.useCallback)((function(t){"string"==typeof t||null===t?(s(t),window.localStorage.setItem(e,null!==t&&void 0!==t?t:"")):t&&s((function(n){var r=t(n);return window.localStorage.setItem(e,null!==r&&void 0!==r?r:""),r}))}),[e]),Object(r.useCallback)((function(){window.localStorage.removeItem(e),s(void 0)}),[s,e])]},L={userName:void 0,setName:function(){return null},clearName:function(){return null}},z=Object(r.createContext)(L),U=function(e){var t=e.children,n=V("name"),i=Object(o.a)(n,3),c=i[0],a=i[1],s=i[2],l=Object(r.useMemo)((function(){return{userName:c,setName:a,clearName:s}}),[c,a,s]);return Object(D.jsx)(z.Provider,{value:l,children:t})},Y=n(193),_=n(194),H=n(195),J=n(197),q=n(57),G=n.n(q),X=function(e,t){var n=Object(r.useState)(t);return null!==e&&void 0!==e?e:n},K=n(234),Q=Object(x.a)({progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:6},progressBarRail:{height:6},progressBarTrack:{height:6},progressBarThumb:{height:18,width:18,marginTop:-6},progressBarMark:{height:14,marginTop:-3},markedSlider:{margin:0}}),Z=function(e){var t=e.styles,n=Object(s.a)(e,["styles"]),r=Q();return Object(D.jsx)("div",{style:t,children:Object(D.jsx)(K.a,Object(O.a)({classes:{colorPrimary:r.progressBarColor,root:r.progressBarRoot,rail:r.progressBarRail,track:r.progressBarTrack,thumb:r.progressBarThumb,mark:r.progressBarMark,marked:r.markedSlider}},n))})},$=n(86),ee=function(e,t,n,i,c,a,s){var l=Object(o.a)(t,2),u=l[0],d=l[1],j=Object(r.useState)(!1),b=Object(o.a)(j,2),h=b[0],p=b[1],f=Object(r.useState)(!1),O=Object(o.a)(f,2),x=O[0],g=O[1],m=e.progress,v=e.setProgress,y=e.setProgressWithVideoUpdate;Object(r.useEffect)((function(){h&&n.current&&i(n.current.getDuration())}),[i,n,h]);var k=Object(r.useMemo)((function(){return{playing:!x&&u,progressInterval:100,onProgress:function(e){var t=e.played;return v(t)},onReady:function(){return p(!0)},onEnded:function(){return d(!1)}}}),[x,u,d,v]),C=Object($.a)((function(e){return y(e/100)}),10),w=function(e,t){var n=Object(r.useState)(e),i=Object(o.a)(n,2),c=i[0],a=i[1],s=Object(r.useCallback)((function(e){a(e),t(e)}),[a,t]);return{value:c,setWithoutVideoUpdate:a,setWithVideoUpdate:s}}(100*m,C),S=w.value,T=w.setWithVideoUpdate,M=w.setWithoutVideoUpdate;Object(r.useEffect)((function(){M(100*m)}),[m,M]);var N=Object(r.useMemo)((function(){return{value:S,min:100*c.start,max:100*c.end,step:1e-4,onChange:function(e,t){a&&a(),g(!0),T(t)},onChangeCommitted:function(e,t){g(!1)}}}),[S,c,a,T,y]);return Object(r.useEffect)((function(){m>c.end+1e-4?s&&!x?y(c.start):(y(c.end),d(!1)):m<c.start-1e-4&&y(c.start+.1)}),[m,u,d,c.end,c.start,s,y,x]),{playerProps:k,progressBarProps:N,showControls:!0,isPlaying:u,toggleIsPlaying:function(){return d((function(e){return!e}))}}},te=n(233),ne=function(e){var t=e.children,n=e.open,r=e.value;return Object(D.jsx)(te.a,{open:n,enterTouchDelay:0,placement:"top",title:r,children:t})},re=Object(x.a)({videoControlsContainer:{display:"flex",left:"50%",position:"absolute",bottom:"50%",transform:"translate(-50%, 50%)"},videoPlayerButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #f54414 90%)"},roundButton:{borderRadius:"50px",width:"64px",height:"64px",color:"white",display:"relative",top:"4px"},videoPlayerContainer:{position:"relative",bottom:0,top:0,right:0,left:0},progressBarContainer:{left:"0",bottom:"0",marginBottom:"-39px",transform:"translateY(calc(-100% - 16px))"},progressBarColor:{color:"#f54414"},progressBarRoot:{padding:"0px",width:"96%",transform:"translateX(2%)",height:4},progressBarRail:{height:4},progressBarTrack:{height:4},progressBarThumb:{height:12,marginTop:-4},progressBarMark:{height:10,marginTop:-3}}),ie=function(e){var t=e.url,n=e.playerRef,i=e.controller,c=e.sliderMarks,a=e.progressState,s=e.onProgressDrag,l=e.slider,d=e.loop,j=re(),h=X(null===i||void 0===i?void 0:i.durationState,0),p=Object(o.a)(h,2),f=p[0],x=p[1],g=a.progress,m=a.setProgressWithVideoUpdate,y=X(null===i||void 0===i?void 0:i.playingState,!1),k=X(null===i||void 0===i?void 0:i.splitState,{start:0,end:1}),C=Object(o.a)(k,1)[0],w=ee(a,y,n,x,C,s,d),S=w.playerProps,T=w.progressBarProps,M=w.showControls,N=w.isPlaying,R=w.toggleIsPlaying,P=Object(r.useCallback)((function(e){return v((e/100-C.start===0?0:e/100-C.start)*f)}),[f,C.start]),F=Object(r.useCallback)((function(){f&&m((function(e){return e+5/f}))}),[m,f]),W=Object(r.useCallback)((function(){f&&m((function(e){return e-5/f}))}),[m,f]);return Object(D.jsxs)(b.a,{className:j.videoPlayerContainer,children:[Object(D.jsx)(G.a,Object(O.a)({url:t,ref:n,width:"100%",height:"100%",loop:d},S)),M&&Object(D.jsxs)("div",{className:j.videoControlsContainer,children:[Object(D.jsx)("div",{style:{position:"absolute",right:"240px",bottom:-4},children:Object(D.jsx)(Y.a,{disableRipple:!0,className:"".concat(j.videoPlayerButton," ").concat(j.roundButton),onClick:W,children:Object(D.jsx)(_.a,{fontSize:"large"})})}),Object(D.jsx)(Y.a,{disableRipple:!0,variant:"contained",color:"primary",className:j.videoPlayerButton,onClick:R,children:N&&Object(D.jsx)(H.a,{fontSize:"large"})||Object(D.jsx)(u.a,{fontSize:"large"})}),Object(D.jsx)("div",{style:{position:"absolute",left:"240px",bottom:-4},children:Object(D.jsx)(Y.a,{onClick:F,disableRipple:!0,className:"".concat(j.videoPlayerButton," ").concat(j.roundButton),children:Object(D.jsx)(J.a,{fontSize:"large"})})})]}),l||Object(D.jsxs)("div",{className:j.progressBarContainer,children:[Object(D.jsx)(B.a,{variant:"caption",style:{margin:"8px",color:"#FFFFFF"},children:f&&"".concat(v((g-C.start)*f)," / ").concat(v((C.end-C.start)*f))}),Object(D.jsx)(Z,Object(O.a)({valueLabelDisplay:"auto",valueLabelFormat:P,ValueLabelComponent:ne,marks:c||[]},T))]})]})},ce=function(e){var t=Object(r.useRef)(null),n=Object(r.useCallback)((function(e){var n,r,i=null===t||void 0===t||null===(n=t.current)||void 0===n?void 0:n.getSecondsLoaded();i&&i>0&&(null===(r=t.current)||void 0===r||r.seekTo(e,"fraction"))}),[]),i=Object(r.useState)(0),c=Object(o.a)(i,2),a=c[0],s=c[1],l=Object(r.useState)({start:0,end:1}),u=Object(r.useCallback)((function(e){"number"===typeof e?(s(e),n(e)):s((function(t){var r=e(t);return n(r),r}))}),[n]),d=Object(r.useState)(0),j=Object(o.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(null!==e&&void 0!==e&&e);return{progressState:{progress:a,setProgress:s,setProgressWithVideoUpdate:u},splitState:l,playingState:p,duration:b,controller:{durationState:[b,h],playingState:p,splitState:l},playerRef:t}},ae=n(229),oe=function(e,t){return e.reduce((function(e,t,n,r){return n+1<r.length?e.concat([[t,r[n+1]]]):e}),[]).map((function(e){return t(e[0],e[1])}))},se=function(e,t){return e.filter(t).length>0},le=Object(r.createContext)([[],function(){return null}]),ue={ChunksProvider:function(e){var t=e.state,n=e.children;return Object(D.jsx)(le.Provider,{value:t,children:n})},useChunksState:function(){return Object(r.useContext)(le)}},de=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1],n=Object(r.useCallback)(t,[]);return Object(r.useCallback)((function(e,t,r){n((function(n){return n.map((function(n){var i,c;return n.id===e.id?Object(O.a)(Object(O.a)({},(null===(i=n.review)||void 0===i?void 0:i.selectedtranscription)===(null===(c=function(e,t){return e.transcriptions.filter((function(e){return e.creatorid===t}))[0]}(n,r))||void 0===c?void 0:c.id)&&""===t?function(e){return Object(O.a)(Object(O.a)({},e),{},{review:void 0})}(n):n),{},{transcriptions:se(n.transcriptions,(function(e){return e.creatorid===r}))?""===t?n.transcriptions.filter((function(e){return e.creatorid!==r})):n.transcriptions.map((function(e){return e.creatorid===r?Object(O.a)(Object(O.a)({},e),{},{content:t}):e})):n.transcriptions.concat(""===t?[]:[{creatorid:r,content:t,id:Object(ae.a)(),updatedat:new Date}])}):n}))}))}),[n])},je=function(e,t){return""!==e?Object(O.a)(Object(O.a)({},t),{},{name:e}):Object(O.a)(Object(O.a)({},t),{},{name:void 0})},be=Object(x.a)({button:function(e){return{backgroundColor:"#d9534f",color:"#FFFFFF",lineHeight:"34px",height:"60px",borderRadius:e?"50%":"6px",padding:e?"4px":"3px 8px 3px 8px",textTransform:"none","&:hover":{backgroundColor:"#ff7570"},"&:disabled":{backgroundColor:"#fabbb9"}}}}),he=function(e){var t=e.children,n=e.round,r=e.styles,i=Object(s.a)(e,["children","round","styles"]),c=function(e){return Object(x.a)({overrideStyles:Object(O.a)({},e)})}(r)(),a=be(!!n);return Object(D.jsx)(Y.a,Object(O.a)(Object(O.a)({disableRipple:!0,className:"".concat(a.button," ").concat(c.overrideStyles)},i),{},{children:t}))},pe=n(227),fe=n(230),Oe=n(198),xe=n(200),ge=n(92),me=i.a.forwardRef((function(e,t){var n=e.children,r=e.style;return Object(D.jsx)(ge.a,{ref:t,elevation:0,style:r,children:n})})),ve=Object(x.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"}}),ye=function(e){var t=e.children,n=e.header,r=e.exit,i=Object(s.a)(e,["children","header","exit"]),c=ve();return Object(D.jsx)(fe.a,Object(O.a)(Object(O.a)({className:c.modal},i),{},{children:Object(D.jsx)(Oe.a,{style:{outline:"none"},children:Object(D.jsxs)(me,{children:[n&&Object(D.jsxs)(h.a,{children:[Object(D.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"8px"},children:[Object(D.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignContent:"center"},children:n}),Object(D.jsx)(he,{onClick:r,children:Object(D.jsx)(xe.a,{})})]}),Object(D.jsx)(P.a,{style:{margin:"12px 0px 12px 0px"}})]}),Object(D.jsx)("div",{className:c.modalContentBox,children:t})]})})}))},ke=window.location.href.split("apikey=")[1];console.log(ke);var Ce,we="localhost",Se=ke,Te=function(e){var t=1===e["data-index"];return Object(D.jsx)("span",Object(O.a)(Object(O.a)({},e),{},{style:Object(O.a)(Object(O.a)({},e.style),{},{transform:t?"0":"translateY(14px)",backgroundColor:t?"#d9534f":"#f77965"}),children:t?null:Object(D.jsx)("div",{style:{height:"14px",width:"4px",transform:"translateY(-9px)",backgroundColor:"#f77965"}})}))},Me=function(e){var t=e.story_id,n=e.chunk,i=e.storyDuration,c=e.croppedSplitState,a=ce(),s=a.progressState,l=a.controller,u=a.playerRef,d=Object(r.useState)([0,0]),j=Object(o.a)(d,2),b=j[0],p=j[1],f=Object(o.a)(c,2),O=f[0],x=f[1],g=s.setProgressWithVideoUpdate;return Object(r.useEffect)((function(){g(n.starttimeseconds);var e=n.starttimeseconds-2/i,t=n.endtimeseconds+2/i;p([e<0?0:e,t>1?1:t]),x([n.starttimeseconds,n.endtimeseconds])}),[n.starttimeseconds,n.endtimeseconds,i,g,x]),Object(D.jsxs)("div",{children:[Object(D.jsx)(h.a,{children:Object(D.jsx)("h2",{style:{margin:0},children:"Cropping:"})}),Object(D.jsx)(ie,{progressState:s,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(t),controller:l,playerRef:u,slider:Object(D.jsx)(Z,{value:[100*O[0],100*s.progress,100*O[1]],min:100*b[0],max:100*b[1],step:1e-4,ThumbComponent:Te,onChange:function(e,t){x([t[0]/100,t[2]/100]),s.setProgressWithVideoUpdate(t[1]/100)}})})]})},Ne=function(e){var t=Object(o.a)(e.nameState,2),n=t[0],r=t[1];return Object(D.jsx)(pe.a,{variant:"outlined",label:"Edit Name",style:{marginTop:"8px"},value:n,onChange:function(e){return r(e.target.value)}})},Re=function(e){var t=e.story_id,n=e.chunk,i=e.exit,c=e.storyDuration,a=Object(r.useState)(""),s=Object(o.a)(a,2),l=s[0],u=s[1];Object(r.useEffect)((function(){n&&u(n.name?n.name:"")}),[n]);var d=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1];return function(e,n,r,i,c){t((function(t){var a,o,s=(a=e,(o=t).reduce((function(e,t,n){return t.id===a.id?{prev:o[n-1],next:o[n+1]}:e}),{prev:void 0,next:void 0}));return function(e){return e.filter((function(e){return e.endtimeseconds>e.starttimeseconds}))}(t.map((function(t){var i,a;return t.id===e.id?Object(O.a)(Object(O.a)({},c?je(c,t):Object(O.a)(Object(O.a)({},t),{},{name:void 0})),{},{starttimeseconds:r[0],starttimestamp:m(r[0]*n),endtimeseconds:r[1],endtimestamp:m(r[1]*n),updatedat:new Date}):t.id===(null===(i=s.next)||void 0===i?void 0:i.id)?Object(O.a)(Object(O.a)({},t),{},{starttimeseconds:r[1],starttimestamp:m(r[1]*n),updatedat:new Date}):t.id===(null===(a=s.prev)||void 0===a?void 0:a.id)?Object(O.a)(Object(O.a)({},t),{},{endtimeseconds:r[0],endtimestamp:m(r[0]*n),updatedat:new Date}):t})).concat(s.prev||0===r[0]?[]:[{starttimestamp:m(0),starttimeseconds:0,endtimestamp:m(r[0]*n),endtimeseconds:r[0],creatorid:i,updatedat:new Date,id:Object(ae.a)(),transcriptions:[]}])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}))}))}}(),j=Object(r.useState)([0,0]),b=Object(o.a)(j,2),h=b[0],p=b[1],f=Object(r.useContext)(z).userName;return Object(D.jsx)(ye,{exit:function(){n&&f&&d(n,c,h,f,l),i()},open:void 0!==n,header:Object(D.jsx)(Ne,{nameState:[l,u]}),children:Object(D.jsx)("div",{style:{paddingBottom:"24px"},children:n&&Object(D.jsx)(Me,{story_id:t,croppedSplitState:[h,p],storyDuration:c,chunk:n})})})},Be=function(e){var t=e.url,n=e.time,i=Object(r.useRef)(null);return Object(D.jsx)(G.a,{crossOrigin:"anonymous",url:t,width:"100%",height:"100%",playing:!1,ref:i,id:"video-thumbnail-player",onReady:function(){var e;null===(e=i.current)||void 0===e||e.seekTo(n,"fraction")}})},Pe=n(66),De=n(202),Fe=Object(x.a)({backButton:{}}),We=function(e){var t=e.action,n=Fe();return Object(D.jsxs)(Pe.a,{className:n.backButton,onClick:t,children:[Object(D.jsx)(De.a,{fontSize:"large"}),Object(D.jsx)(B.a,{variant:"h5",style:{position:"relative",left:-5},children:"Back"})]})},Ie=n(61);!function(e){e[e.True=0]="True"}(Ce||(Ce={}));var Ee=function(e,t){var n=Object(r.useState)(Ce.True),i=Object(o.a)(n,2),c=i[0],a=i[1],s=Object(r.useCallback)((function(){c!==Ce.True&&(e.apply(void 0,Object(Ie.a)(c)),a(Ce.True))}),[c,e]);return{attemptingActionWith:c,cancelAction:function(){return a(Ce.True)},attemptAction:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.apply(void 0,r)?a(r):e.apply(void 0,r)},confirmAction:s}},Ae=n(204),Ve=n(203),Le=function(e){var t=e.message;return Object(D.jsx)("h2",{style:{margin:0},children:Object(D.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(D.jsx)(Ve.a,{style:{marginRight:"8px"},fontSize:"large"}),t]})})},ze=function(e){var t=e.actionControls,n=e.warningMessage,r=e.children,i=t.attemptingActionWith,c=t.cancelAction,a=t.confirmAction;return Object(D.jsx)(ye,{open:i!==Ce.True,exit:c,header:Object(D.jsx)(Le,{message:n}),children:Object(D.jsxs)("div",{children:[i!==Ce.True&&r.apply(void 0,Object(Ie.a)(i)),Object(D.jsx)("br",{}),Object(D.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(D.jsxs)(he,{style:{marginTop:"8px"},onClick:a,children:[Object(D.jsx)(Ae.a,{fontSize:"large",style:{marginRight:"8px"}}),Object(D.jsx)(B.a,{variant:"subtitle1",children:"Confirm"})]})})]})})},Ue=function(e){var t=e.chunk,n=e.exit;return Object(D.jsx)(ye,{open:void 0!==t,header:Object(D.jsx)("h2",{style:{margin:0,overflowWrap:"anywhere"},children:'Transcriptions for "'.concat(t&&M(t),'"')}),exit:n,children:Object(D.jsx)("div",{style:{overflow:"scroll"},children:null===t||void 0===t?void 0:t.transcriptions.map((function(e){return Object(D.jsx)(F,{title:Object(D.jsx)("b",{children:e.creatorid}),contentStyle:{whiteSpace:"pre"},children:e.content},e.id)}))})})},Ye=function(e){var t=e.children,n=e.style,i=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}),[]),Object(D.jsx)("div",{ref:i,style:Object(O.a)({},n),children:t})},_e=n(206),He=n(207),Je=n(208),qe=n(91),Ge=n(205),Xe=i.a.forwardRef((function(e,t){var n=e.anchor,r=e.show,i=e.menuItems;return Object(D.jsx)(qe.a,{ref:t,anchorEl:n,open:r,children:i.map((function(e,t){return Object(D.jsx)(Ge.a,{onClick:e.handler,children:e.content},t)}))})})),Ke=function(e){var t=e.menuItems,n=Object(r.useState)(!1),i=Object(o.a)(n,2),c=i[0],a=i[1],s=Object(r.useRef)(null);return Object(D.jsxs)("div",{style:{position:"relative",top:0,right:0,display:"flex",flexDirection:"row",alignSelf:"flex-start"},children:[Object(D.jsx)(_e.a,{onClickAway:function(){return a(!1)},children:Object(D.jsx)(He.a,{style:{padding:0},onClick:function(){return a(!0)},ref:s,children:Object(D.jsx)(Je.a,{})})}),Object(D.jsx)(Xe,{show:c,anchor:s.current,menuItems:t})]})},Qe=n(209),Ze=Object(x.a)({loadingModal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"}}),$e=function(e){var t=e.open,n=Ze();return Object(D.jsx)(fe.a,{open:t,className:n.loadingModal,children:Object(D.jsx)(Oe.a,{style:{outline:"none",display:"flex",justifyContent:"center"},children:Object(D.jsx)(Qe.a,{})})})},et=n(236),tt=n(210),nt=n(232),rt=n(211),it=function(e){var t=Object(r.useState)([0,null]),n=Object(o.a)(t,2),i=Object(o.a)(n[0],2),c=i[0],a=i[1],s=n[1],l=Object(r.useCallback)((function(){s([0,null])}),[s]),u=Object(r.useMemo)((function(){return c===e.length-1}),[c,e.length]);return{page:c,direction:a,goTo:function(t){return"next"===t&&c<e.length-1?s((function(e){return[Object(o.a)(e,1)[0]+1,"next"]})):"prev"===t&&c>0?s((function(e){return[Object(o.a)(e,1)[0]-1,"prev"]})):null},reset:l,lastPage:u}},ct=Object(x.a)({contentContainer:{paddingBottom:"32px",height:"40vh",display:"flex",flexDirection:"column"},instructionsContainer:{flexGrow:4},divider:{marginBottom:"16px"},centerVertically:{position:"relative",top:"50%",transform:"translateY(-50%)"},buttonsContainer:{display:"flex",justifyContent:"space-between"}}),at=function(e){var t=e.show,n=e.dismiss,i=e.title,c=e.steps,a=e.startButtonContent,o=it(c),s=o.page,l=o.goTo,u=o.reset,d=Object(r.useCallback)((function(){u(),n()}),[]),j=Object(r.useCallback)((function(){s===c.length-1?d():l("next")}),[s,l,d,c.length]),b=Object(r.useCallback)((function(){l("prev")}),[l]),p=ct();return Object(D.jsx)(ye,{header:i,open:t,exit:d,children:Object(D.jsxs)("div",{className:p.contentContainer,children:[Object(D.jsx)(et.a,{activeStep:s,children:c.map((function(e,t){return Object(D.jsx)(tt.a,{children:Object(D.jsx)(nt.a,{})},t)}))}),Object(D.jsxs)(h.a,{className:p.instructionsContainer,children:[Object(D.jsx)(P.a,{className:p.divider}),Object(D.jsx)("div",{className:p.centerVertically,children:Object(D.jsx)(B.a,{variant:"h5",children:c[s]})})]}),Object(D.jsxs)(h.a,{className:p.buttonsContainer,children:[0===s?Object(D.jsx)("div",{}):Object(D.jsxs)(Pe.a,{onClick:b,children:[Object(D.jsx)(De.a,{})," Previous"]}),Object(D.jsx)(Pe.a,{onClick:j,children:s===c.length-1?a:Object(D.jsxs)(D.Fragment,{children:["Next ",Object(D.jsx)(rt.a,{})]})})]})]})})},ot=function(e){var t=e.atExit,n=e.story_id,i=e.onboarding,c=ue.useChunksState(),a=Object(o.a)(c,2),x=a[0],g=a[1];Object(r.useEffect)((function(){g((function(e){return e}))}),[g]);var v=ce(),S=v.progressState,T=v.playingState,N=v.duration,R=v.controller,B=v.playerRef,P=S.progress,W=S.setProgressWithVideoUpdate,A=Object(o.a)(T,2)[1],V=Object(r.useMemo)((function(){return function(e){return e.map((function(e){return{value:100*e.endtimeseconds}}))}(x)}),[x]),L=Object(r.useContext)(z).userName,U=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1];return function(e){t((function(t){return e(t),t}))}}(),Y=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1];return function(e){return t((function(t){return oe(t.filter((function(t){return t.id!==e.id})),(function(e,t){return e.endtimeseconds!==t.starttimeseconds?Object(O.a)(Object(O.a)({},t),{},{starttimeseconds:e.endtimeseconds,starttimestamp:e.endtimestamp,id:Object(ae.a)(),updatedat:new Date,transcriptions:[]}):t})).concat((n=t.filter((function(t){return t.id!==e.id}))[0],n?0===n.starttimeseconds?[n]:[Object(O.a)(Object(O.a)({},n),{},{starttimeseconds:0,starttimestamp:"00:00:00:00",id:Object(ae.a)(),updatedat:new Date,transcriptions:[]})]:[])).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds}));var n}))}}(),_=function(e){return function(t,n,r){e((function(e){if(function(e,t,n){return 0===t||t>n||e.reduce((function(e,n){return e||n.endtimeseconds===t||n.starttimeseconds===t}),!1)}(e,t,n))return e;var i=C(e,t);return void 0!==i?e.filter((function(e){return e.id!==i.id})).concat([{starttimestamp:i.starttimestamp,starttimeseconds:i.starttimeseconds,endtimestamp:m(t*n),endtimeseconds:t,creatorid:r,updatedat:new Date,id:Object(ae.a)(),transcriptions:[]},{starttimestamp:m(t*n),starttimeseconds:t,endtimestamp:i.endtimestamp,endtimeseconds:i.endtimeseconds,creatorid:r,updatedat:new Date,id:Object(ae.a)(),transcriptions:[]}]).sort((function(e,t){return e.endtimeseconds-t.endtimeseconds})):e.concat([{starttimestamp:y(e),endtimestamp:m(t*n),starttimeseconds:k(e),endtimeseconds:t,creatorid:r,updatedat:new Date,id:Object(ae.a)(),transcriptions:[]}])}))}}(g),H=E(),J=Object(r.useState)(void 0),q=Object(o.a)(J,2),G=q[0],X=q[1];Object(r.useEffect)((function(){void 0!==G&&P>G.endtimeseconds&&(X(void 0),A(!1))}),[P,G,x,A]);var K=Object(r.useCallback)((function(e,t,n){(null===t||void 0===t?void 0:t.id)===e.id&&n?A(!1):(A(!0),X(e),W(e.starttimeseconds))}),[W,A]),Q=Object(r.useState)(void 0),Z=Object(o.a)(Q,2),$=Z[0],ee=Z[1],te=Ee((function(e,t,n,r){return _(t,n,r)}),(function(e,t){var n=C(e,t);return void 0!==n&&w(n)})),ne=te.attemptAction,re=Object(s.a)(te,["attemptAction"]),se=Ee(Y,(function(e){return w(e)})),le=se.attemptAction,de=Object(s.a)(se,["attemptAction"]),je=Object(r.useState)(void 0),be=Object(o.a)(je,2),pe=be[0],fe=be[1],Oe=Object(r.useMemo)((function(){return{marginRight:"4px",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.8}}),[]),xe=Object(r.useRef)({backgroundColor:"green",height:"100%",padding:"16px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",color:"white"}),ge=Object(r.useRef)({margin:"8px",transform:"translateY(8px)",height:"calc(100% - 16px)"}),me=i.showOnboardingModal,ve=i.dismissOnboardingModal,ye=Object(r.useCallback)((function(){return X(void 0)}),[X]);return Object(D.jsxs)(b.a,{children:[Object(D.jsx)($e,{open:0===N}),Object(D.jsx)(h.a,{children:Object(D.jsx)("div",{className:H.backButtonContainer,children:Object(D.jsx)(We,{action:t})})}),Object(D.jsx)(at,{show:me,dismiss:ve,title:Object(D.jsx)("h2",{className:H.onboardingTitle,children:"Chunking Instructions"}),steps:["You are about to chunk the video. The aim of chunking is to make Transcribing easy.","Rather than transcribing the entire video at once, you will break the video down into smaller chunks, which you will transcribe individually.","You should aim to have only one person speaking in each chunk. Create a new chunk when there is a change in who is talking, there is a gap in the talking, or a person begins/ends talking.","To create a chunk, press the '+' button in the bottom right corner. The time that you press the '+' button in the video will be the end of the new chunk."],startButtonContent:Object(D.jsx)("div",{children:"Start Chunking"})}),Object(D.jsx)(Re,{story_id:n,chunk:$,exit:function(){return ee(void 0)},storyDuration:N}),Object(D.jsx)(ze,{actionControls:de,warningMessage:Object(D.jsx)("div",{children:"This Chunk has a transcription"}),children:function(){return Object(D.jsxs)("div",{style:{overflowWrap:"anywhere"},children:["Attempting to delete chunk",(arguments.length<=0?void 0:arguments[0])&&' "'.concat(M(arguments.length<=0?void 0:arguments[0]),'"'),", which has a transcription saved to it. Are you sure you want to delete it?"]})}}),Object(D.jsx)(ze,{actionControls:re,warningMessage:Object(D.jsx)("div",{children:"The enclosing chunk has a transcription"}),children:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Object(D.jsxs)("div",{children:['Creating a new chunk here will delete the transcriptions on the enclosing chunk, "',M(null!==(e=C(n[0],n[1]))&&void 0!==e?e:n[0][0]),'". Are you sure you want to discard these transcriptions?']})}}),Object(D.jsx)(Ue,{chunk:pe,exit:function(){return fe(void 0)}}),Object(D.jsx)("div",{className:H.videoPlayerContainer,children:Object(D.jsx)(ie,{controller:R,progressState:S,playerRef:B,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),sliderMarks:V,onProgressDrag:ye})}),Object(D.jsx)(p.a,{className:H.chunksList,cellHeight:"auto",cols:2.5,children:x.map((function(e){return Object(D.jsx)(f.a,{children:Object(D.jsx)(Ye,{children:Object(D.jsx)(I,{chunk:e,transcriptionIcon:Object(D.jsx)(Ke,{menuItems:[{content:"Delete",handler:function(){return function(e){U((function(t){t.forEach((function(t){return t.id===e.id&&le(t)}))}))}(e)}},{content:"Edit",handler:function(){return ee(e)}}].concat(0!==e.transcriptions.length?[{content:"View Transcriptions",handler:function(){return fe(e)}}]:[])}),children:Object(D.jsxs)("div",{className:H.chunkCardBody,children:[Object(D.jsx)(Be,{url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),time:e.starttimeseconds+(e.endtimeseconds-e.starttimeseconds)/2}),Object(D.jsx)(he,{round:!0,color:"primary",style:Oe,onClick:function(){return K(e,G,T[0])},children:(null===G||void 0===G?void 0:G.id)===e.id&&T[0]?Object(D.jsx)(l.a,{}):Object(D.jsx)(u.a,{})})]})})})},e.id)})).concat(k(x)>.75?[Object(D.jsx)(f.a,{onClick:function(){1!==k(x)&&L&&_(1,N,L),t()},children:Object(D.jsx)(Ye,{style:{height:"100%"},children:Object(D.jsx)(F,{contentStyle:xe.current,cardStyle:ge.current,children:Object(D.jsx)(d.a,{fontSize:"large",style:{marginRight:"4px"}})})})},"Done Card")]:[])}),Object(D.jsx)("div",{children:Object(D.jsx)("div",{className:H.newChunkButtonContainer,children:Object(D.jsx)(he,{round:!0,"aria-label":"New Chunk",style:{margin:"8px"},onClick:function(){L&&ne(x,P,N,L)},children:Object(D.jsx)(j.a,{})})})})]})},st=n(158);var lt,ut=function(e){return Object(D.jsxs)(b.a,{display:"flex",alignItems:"center",children:[Object(D.jsx)(b.a,{width:"100%",mr:1,children:Object(D.jsx)(st.a,Object(O.a)({variant:"determinate"},e))}),Object(D.jsx)(b.a,{minWidth:35,children:Object(D.jsx)(B.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},dt="#dddddd",jt=Object(x.a)({paper:{border:"1px solid ".concat(dt),borderTop:"0",borderTopRightRadius:"0",borderTopLeftRadius:"0",padding:"15px"},stepHeader:{padding:"4px",backgroundColor:"#f5f5f5",border:"1px solid ".concat(dt),borderBottomRightRadius:"0",borderBottomLeftRadius:"0"},button:{marginTop:"16px"}}),bt=function(e){var t=e.title,n=e.description,r=e.progress,i=e.onSelect,c=e.enabled,a=jt();return Object(D.jsxs)("div",{children:[Object(D.jsx)(me,{children:Object(D.jsxs)("div",{className:a.stepHeader,children:[Object(D.jsx)(B.a,{variant:"subtitle1",children:t}),Object(D.jsx)(ut,{value:r})]})}),Object(D.jsx)(me,{children:Object(D.jsxs)("div",{className:a.paper,children:[n,Object(D.jsx)("br",{}),Object(D.jsx)(b.a,{style:{marginTop:"8px"},children:Object(D.jsx)(he,{disabled:!c,onClick:i,children:Object(D.jsxs)(B.a,{style:{padding:"6px"},children:["Perform ",t]})})})]})})]})},ht=Object(x.a)({introContainer:{textAlign:"center"},transcriberModal:{display:"flex",flexDirection:"column"}}),pt=n(235),ft=i.a.forwardRef((function(e,t){var n=e.placeholder,i=e.buttonText,c=e.classes,a=e.onSubmit,s=Object(r.useState)(null),l=Object(o.a)(s,2),u=l[0],d=l[1];return Object(D.jsxs)("div",{ref:t,children:[Object(D.jsx)(pt.a,{className:c.input,onChange:function(e){return d(e.target.value)},placeholder:n}),Object(D.jsx)(he,{onClick:function(){return u&&a(u)},styles:{height:"3rem",borderRadius:"0px 8px 8px 0px"},children:Object(D.jsx)(B.a,{variant:"subtitle1",children:i})})]})})),Ot=Object(x.a)({modal:{outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},modalContentBox:{padding:"16px"},input:{flex:1,width:"400px",height:"3rem",border:"1px solid #cccccc",paddingLeft:"8px",borderRadius:"8px 0px 0px 8px"}}),xt=function(e){var t=e.show,n=e.setName,r=Ot();return Object(D.jsx)(ye,{open:t,children:Object(D.jsxs)("div",{children:[Object(D.jsx)(B.a,{variant:"subtitle1",children:"Please enter your name before performing transcription:"}),Object(D.jsx)(ft,{placeholder:"my name",buttonText:"Perform Transcription",classes:r,onSubmit:n})]})})},gt=n(217),mt=Object(x.a)({indabaLink:{color:"#d9534f",cursor:"pointer"}}),vt=i.a.forwardRef((function(e,t){var n=e.children,r=Object(s.a)(e,["children"]),i=mt();return Object(D.jsx)(gt.a,Object(O.a)(Object(O.a)({ref:t,className:i.indabaLink},r),{},{children:n}))})),yt=function(e){var t=e.name;return Object(D.jsx)(B.a,{style:{fontWeight:"lighter",overflowWrap:"anywhere"},variant:"h5",children:t&&"Hello ".concat(t)})},kt=function(e){var t=e.storyName;return Object(D.jsxs)(B.a,{variant:"h3",style:{color:"gray",fontWeight:"lighter"},children:["Field Transcription for"," ",Object(D.jsx)(b.a,{component:"span",style:{color:"black"},children:t})]})},Ct=function(e){var t=e.storyName,n=e.steps,i=e.logOutAction,c=Object(r.useContext)(z),a=c.userName,o=c.setName,s=c.clearName,l=ht();return Object(D.jsxs)(h.a,{children:[Object(D.jsx)(xt,{setName:o,show:!a}),Object(D.jsxs)(h.a,{className:l.introContainer,children:[Object(D.jsx)(kt,{storyName:t}),Object(D.jsx)(yt,{name:a}),a&&Object(D.jsx)(vt,{onClick:function(){s(),i()},children:"This is not me!"})]}),Object(D.jsx)("div",{style:{marginBottom:"16px"},children:"There are 3 stages to transcribing, select which stage you are performing"}),Object(D.jsx)(b.a,{children:Object(D.jsx)(p.a,{cols:3,cellHeight:"auto",spacing:20,children:n.map((function(e){return Object(D.jsx)(f.a,{children:Object(D.jsx)(bt,Object(O.a)({},e))},e.title)}))})})]})},wt=Object(x.a)({buildVersion:{fontFamily:"Open Sans",color:"#7a7a7a",fontWeight:"bold",fontSize:"19px",position:"absolute",paddingTop:"10px",top:"-5px",left:"122px"},titleRow:{marginTop:"5px",display:"flex",flexDirection:"row",height:"48px",position:"relative"},logoContainer:{position:"relative",paddingTop:"6px",width:"25%"},titleContainer:{width:"50%",height:"48px",marginTop:"10px",paddingLeft:"15px",paddingRight:"15px",textAlign:"center"},titleWrapper:{fontSize:"13pt",margin:"3px",display:"inline-block"},contextMenuButton:{position:"absolute",right:0}}),St=n.p+"static/media/logo_web.d3de7844.svg",Tt=function(e){var t=e.children,n=e.title,i=e.contextMenuItems,c=e.hidden,a=wt(),s=Object(r.useRef)(null),l=A(!1),u=Object(o.a)(l,3),d=u[0],j=u[1],b=u[2];return Object(D.jsx)(D.Fragment,{children:Object(D.jsxs)(h.a,{style:{height:"calc(100vh - 5px)",width:"100%",padding:0,marginTop:"5px",display:"flex",flexDirection:"column"},children:[c?null:Object(D.jsxs)(h.a,{children:[Object(D.jsxs)("div",{className:a.titleRow,children:[Object(D.jsxs)("div",{className:a.logoContainer,children:[Object(D.jsx)("img",{src:St,alt:"logo",width:"120px",height:"36px"}),Object(D.jsx)("span",{className:a.buildVersion,children:"TITAN"})]}),Object(D.jsx)("div",{className:a.titleContainer,children:Object(D.jsx)("div",{className:a.titleWrapper,children:n})}),Object(D.jsx)(_e.a,{onClickAway:function(){return b(!1)},children:Object(D.jsx)(He.a,{className:a.contextMenuButton,onClick:j,ref:s,children:Object(D.jsx)(Je.a,{})})}),Object(D.jsx)(Xe,{show:d,anchor:s.current,menuItems:i})]}),Object(D.jsx)(P.a,{})]}),t]})})};!function(e){e[e.Dashboard=0]="Dashboard",e[e.Chunking=1]="Chunking",e[e.Transcribing=2]="Transcribing",e[e.Reviewing=3]="Reviewing"}(lt||(lt={}));var Mt=lt,Nt=function(e,t){return Object(r.useMemo)((function(){return[{title:"Chunking",description:"We need to know when people are talking in the story, so that we can transcribe them.",progress:t[0].progress,onSelect:function(){return e(Mt.Chunking)},enabled:t[0].enabled},{title:"Transcription",description:"Writing down exactly what is said in each chunk of the story.",progress:t[1].progress,onSelect:function(){return e(Mt.Transcribing)},enabled:t[1].enabled},{title:"Review",description:"Reviewing content is key to making sure we represent participants authentically.",progress:t[2].progress,onSelect:function(){return e(Mt.Reviewing)},enabled:t[2].enabled}]}),[e,t])},Rt=n(221),Bt=n(222),Pt=n(223),Dt="8px",Ft=Object(x.a)({videoPlayerContainer:{position:"relative",overflow:"hidden"},inputField:{width:"100%"},chunkProgressRail:{height:Dt,color:"#d9534f"},chunkProgressTrack:{height:Dt,color:"#d9534f"},chunkProgressMark:{height:Dt,width:"4px",backgroundColor:"#FFFFFF",opacity:.8},stepperDots:{backgroundColor:"#d9534f"},stepperDotsContainer:{flexWrap:"wrap"},stepperDot:{margin:"2px"}}),Wt=n(218),It=n(219),Et=n(220),At=Object(x.a)({slideshowContainer:{display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"flex-end",width:"100%"},slideshowContentContainer:{flexGrow:4}}),Vt=function(e){var t=e.onNavigate,n=e.onComplete,r=e.currentPage,i=e.numberOfPages,c=e.children,a=e.style,o=e.contentContainerStyle,s=e.leftColumn,l=e.rightColumn,u=At();return Object(D.jsxs)("div",{className:u.slideshowContainer,style:a,children:[null!==s&&void 0!==s?s:Object(D.jsx)(he,{round:!0,"aria-label":"Previous",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:0===r,onClick:function(){return t("prev")},children:Object(D.jsx)(Wt.a,{})}),Object(D.jsx)(b.a,{style:Object(O.a)({},o),className:u.slideshowContentContainer,children:c}),null!==l&&void 0!==l?l:n&&r===i-1?Object(D.jsx)(he,{round:!0,"aria-label":"Complete",style:{color:"#FFFFFF",backgroundColor:"#40bf11",alignSelf:"flex-start",marginTop:"32px"},onClick:n,children:Object(D.jsx)(It.a,{})}):Object(D.jsx)(he,{round:!0,"aria-label":"Next",style:{color:"#FFFFFF",alignSelf:"flex-start",marginTop:"32px"},disabled:r===i-1,onClick:function(){return t("next")},children:Object(D.jsx)(Et.a,{})})]})},Lt=function(e){var t=e.inputRef,n=e.transcriptionValue,r=e.transcriptionIcon,i=e.onChange;return Object(D.jsx)(F,{title:r,cardStyle:{margin:"16px 8px 0 8px"},children:Object(D.jsx)(pe.a,{autoFocus:!0,multiline:!0,rows:7,inputRef:t,style:{width:"100%"},variant:"outlined",label:"Transcription",value:n,onChange:function(e){i(e.target.value)}})})},zt=function(e,t){return se(e.transcriptions,(function(e){return e.creatorid===t}))?e.transcriptions.filter((function(e){return e.creatorid===t}))[0]:void 0},Ut=function(e,t){for(var n=[],r=e.starttimeseconds+4/t;r<e.endtimeseconds;)n.push(r),r+=5/t;return r!==e.endtimeseconds&&n.push(e.endtimeseconds),n},Yt=function(e,t){var n=e+1/t;return n>t?t:n},_t=function(e,t,n,i,c,a,o){var s=Object(r.useCallback)((function(n,r,i,o){var s,l,u=(s=r[i-1],l=e[n],null!==s&&void 0!==s?s:l.starttimeseconds);return a(u),c({start:u,end:Yt(r[i],t)}),{miniChunks:r,currentChunk:n,currentMiniChunk:i,transcription:o}}),[a,c,e,t]);return Object(r.useCallback)((function(r,c){var a,l;switch(i&&["go to next page","go to previous page","flush transcription changes"].includes(c.actionType)&&n(e[r.currentChunk],r.transcription,i),c.actionType){case"go to next page":if(r.currentMiniChunk===r.miniChunks.length-1&&r.currentChunk<e.length-1){var u,d,j=r.currentChunk+1;return s(j,Ut(e[j],t),0,null!==(u=null===(d=zt(e[j],null!==i&&void 0!==i?i:""))||void 0===d?void 0:d.content)&&void 0!==u?u:"")}if(r.currentMiniChunk<r.miniChunks.length-1)return s(r.currentChunk,r.miniChunks,r.currentMiniChunk+1,r.transcription);o();break;case"go to previous page":if(0===r.currentMiniChunk&&r.currentChunk>0){var b,h,p=r.currentChunk-1,f=Ut(e[p],t);return s(p,f,f.length-1,null!==(b=null===(h=zt(e[p],null!==i&&void 0!==i?i:""))||void 0===h?void 0:h.content)&&void 0!==b?b:"")}if(r.currentMiniChunk>0)return s(r.currentChunk,r.miniChunks,r.currentMiniChunk-1,r.transcription);break;case"transcription changed":return void 0!==c.newTranscription?Object(O.a)(Object(O.a)({},r),{},{transcription:c.newTranscription}):Object(O.a)({},r);case"go to first mini chunk":return s(r.currentChunk,r.miniChunks,0,r.transcription),Object(O.a)(Object(O.a)({},r),{},{currentMiniChunk:0});case"go to last mini chunk":var x=r.miniChunks.length-1;return s(r.currentChunk,r.miniChunks,x,r.transcription),Object(O.a)(Object(O.a)({},r),{},{currentMiniChunk:x});case"refresh mini chunks":var g=Ut(e[r.currentChunk],t);return s(r.currentChunk,g,0,r.transcription),Object(O.a)(Object(O.a)({},r),{},{currentMiniChunk:0,miniChunks:g,transcription:null!==(a=null===(l=zt(e[r.currentChunk],null!==i&&void 0!==i?i:""))||void 0===l?void 0:l.content)&&void 0!==a?a:""})}return r}),[e,t,n,i,o,s])},Ht=n(88),Jt=function(e,t){var n=Object(r.useState)(!1),i=Object(o.a)(n,2)[1],c=Object(r.useState)(!1),a=Object(o.a)(c,2),s=a[0],l=a[1],u=Object(Ht.a)((function(){t(s),i(!1)}),500);return Object(r.useCallback)((function(){i((function(t){return t||l(e),!0})),u(),t(!1)}),[e,t,u])},qt=function(){return Object(D.jsx)("div",{})},Gt=function(e){var t=e.story_id,n=e.atExit,i=e.onboarding,c=ue.useChunksState(),a=Object(o.a)(c,1)[0],s=i.showOnboardingModal,l=i.dismissOnboardingModal,u=ce(),j=u.progressState,p=u.playerRef,f=Object(o.a)(u.splitState,2),O=f[0],x=f[1],g=u.duration,m=u.controller,y=Object(o.a)(u.playingState,2),k=y[0],C=y[1],w=de(),S=Object(r.useContext)(z).userName,T=j.setProgressWithVideoUpdate,N=_t(a,g,w,S,x,T,n),R=Object(r.useReducer)(N,{currentChunk:0,currentMiniChunk:0,miniChunks:[],transcription:""}),B=Object(o.a)(R,2),P=B[0],F=B[1];Object(r.useEffect)((function(){0!==g&&F({actionType:"refresh mini chunks"})}),[g]);var W=Object(r.useMemo)((function(){return P.currentChunk===a.length-1&&P.currentMiniChunk===P.miniChunks.length-1}),[P.currentChunk,P.currentMiniChunk,P.miniChunks,a]),I=Ft(),E=Object(r.useRef)(null);Object(r.useEffect)((function(){(E.current?E.current:{focus:function(){return null}}).focus()}),[k,P.currentChunk,P.currentMiniChunk]);var A=function(){F({actionType:"flush transcription changes"}),n()},V=Jt(k,C);return Object(D.jsxs)("div",{children:[Object(D.jsx)($e,{open:0===g}),Object(D.jsx)(h.a,{style:{marginBottom:"4px"},children:Object(D.jsx)(We,{action:A})}),Object(D.jsx)(at,{show:s,dismiss:l,title:Object(D.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),steps:["You are about to Transcribe the chunks.","Each chunk has been divided into 5 second clips for you. These clips will loop.","When you type, the video will pause until you stop typing",'When you are done transcribing a clip press the ">" button'],startButtonContent:Object(D.jsx)("div",{children:"Start Transcribing"})}),a.length&&Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(b.a,{className:I.videoPlayerContainer,children:Object(D.jsx)(ie,{progressState:j,playerRef:p,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(t),controller:m,loop:!0})}),Object(D.jsxs)("div",{style:{margin:"0 8px 0 8px"},children:[Object(D.jsx)(Rt.a,{variant:"dots",steps:P.miniChunks.length,activeStep:P.currentMiniChunk,position:"static",classes:{dotActive:I.stepperDots,dots:I.stepperDotsContainer,dot:I.stepperDot},nextButton:Object(D.jsx)(Y.a,{onClick:function(){return F({actionType:"go to last mini chunk"})},children:"Last"}),backButton:Object(D.jsx)(Y.a,{onClick:function(){return F({actionType:"go to first mini chunk"})},children:"First"})}),Object(D.jsx)(Vt,{currentPage:P.currentChunk,onNavigate:function(){return null},numberOfPages:a.length,onComplete:A,leftColumn:Object(D.jsx)("div",{children:Object(D.jsx)(he,{onClick:function(){return F({actionType:"go to previous page"})},children:Object(D.jsx)(Bt.a,{})})}),rightColumn:Object(D.jsx)("div",{children:Object(D.jsx)(he,{style:{backgroundColor:W?"green":"#d9534f"},onClick:function(){return F({actionType:"go to next page"})},children:W?Object(D.jsx)(d.a,{}):Object(D.jsx)(Pt.a,{})})}),children:Object(D.jsx)(Lt,{transcriptionIcon:Object(D.jsxs)("div",{style:{display:"flex",flexDirection:"column",margin:"0 8px 0 8px"},children:[Object(D.jsx)("span",{style:{fontWeight:600,overflowWrap:"anywhere"},children:M(a[P.currentChunk])}),Object(D.jsx)(K.a,{ThumbComponent:qt,value:[100*a[P.currentChunk].starttimeseconds,100*a[P.currentChunk].endtimeseconds],classes:{rail:I.chunkProgressRail,track:I.chunkProgressTrack,mark:I.chunkProgressMark,markActive:I.chunkProgressMark},marks:[{value:100*O.start,label:v(P.miniChunks[P.currentMiniChunk]*g)}]})]}),inputRef:E,transcriptionValue:P.transcription,onChange:function(e){V(),F({actionType:"transcription changed",newTranscription:e})}})})]})]}),Object(D.jsx)("div",{style:{position:"absolute",left:0,bottom:0,width:"100%"},children:!1})]})},Xt=n(65),Kt=n.n(Xt),Qt=n(89),Zt=n(62),$t=n.n(Zt),en=function(e,t){var n="http://".concat(we,":8845/api/watch/savedit/").concat(t,"?apikey=").concat(Se);console.log(Se),console.log(t),console.log(n),$t.a.request({url:n,method:"POST",withCredentials:!0,data:e})},tn=function(e){var t,n=Object(r.useState)(void 0),i=Object(o.a)(n,2),c=i[0],a=i[1],s=Object(r.useMemo)((function(){var e;return null!==(e=null===c||void 0===c?void 0:c.transcription.chunks)&&void 0!==e?e:[]}),[null===c||void 0===c||null===(t=c.transcription)||void 0===t?void 0:t.chunks]),l=Object(r.useCallback)(function(){var t=Object(Qt.a)(Kt.a.mark((function t(n){var r;return Kt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n,t.next=3,$t.a.request({withCredentials:!0,url:"http://".concat(we,":8845/api/watch/edit/").concat(e),transformResponse:function(e){var t,n,r;return null!==(t=null===(n=JSON.parse(e))||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[]}});case 3:t.t1=t.sent.data,r=(0,t.t0)(t.t1),a((function(t){var n=void 0===t?void 0:Object(O.a)(Object(O.a)({},t),{},{transcription:{chunks:r}});return n&&en(n,e),n}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]);Object(r.useEffect)((function(){$t.a.request({url:"http://".concat(we,":8845/api/watch/edit/").concat(e),withCredentials:!0,transformResponse:function(e){return JSON.parse(e)}}).then((function(e){var t,n,r,i;a(e.data),i=null!==(t=null===(n=e.data)||void 0===n||null===(r=n.transcription)||void 0===r?void 0:r.chunks)&&void 0!==t?t:[],a((function(e){return void 0===e?void 0:Object(O.a)(Object(O.a)({},e),{},{transcription:{chunks:i}})}))}))}),[e]);var u=Object(r.useMemo)((function(){return[s,l]}),[s,l]);return{storyTitle:c&&c.title,chunksState:u}},nn=n(201),rn=n(157),cn=n(228),an=n(224),on=n(225),sn=Object(x.a)({doneButton:{backgroundColor:"green",color:"white"},cardContainer:{marginTop:"8px",marginBottom:"8px",padding:"0 8px 0 8px",width:"100%"}}),ln=function(e){var t=e.atExit,n=e.story_id,i=e.onboarding,c=i.showOnboardingModal,a=i.dismissOnboardingModal,s=ce(),l=s.progressState,u=Object(o.a)(s.splitState,2)[1],j=s.controller,p=s.playerRef,f=s.duration,x=l.setProgressWithVideoUpdate,g=ue.useChunksState(),m=Object(o.a)(g,1)[0],v=sn(),y=m.filter(w),k=it(y),C=k.page,S=k.goTo,T=k.lastPage,M=Object(r.useMemo)((function(){return y[C]}),[C,y]);Object(r.useEffect)((function(){u({start:M.starttimeseconds,end:M.endtimeseconds}),x(M.starttimeseconds)}),[C,m,M,x,u]);var N=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1];return function(e,n,r){t((function(t){return t.map((function(t){return t.id===e.id&&se(t.transcriptions,(function(e){return e.id===n.id}))?Object(O.a)(Object(O.a)({},t),{},{review:{reviewedat:new Date,selectedtranscription:n.id,reviewedby:r}}):t}))}))}}(),R=function(){var e=ue.useChunksState(),t=Object(o.a)(e,2)[1];return function(e){t((function(t){return t.map((function(t){return t.id===e.id?Object(O.a)(Object(O.a)({},t),{},{review:void 0}):t}))}))}}(),F=Object(r.useContext)(z).userName,W=Object(r.useState)(""),E=Object(o.a)(W,2),A=E[0],V=E[1],L=Object(r.useState)(void 0),U=Object(o.a)(L,2),Y=U[0],_=U[1];Object(r.useEffect)((function(){V(Y?Y.content:"")}),[Y]);var H=de();return Object(D.jsxs)("div",{children:[Object(D.jsx)($e,{open:0===f}),Object(D.jsx)(h.a,{style:{marginTop:"4px"},children:Object(D.jsx)(We,{action:t})}),Object(D.jsx)(at,{show:c,dismiss:a,steps:["You are about to review the transcriptions made on the video.","For each chunk, select one of the transcriptions from the list. You can do this by clicking on the text or the check box to the left of the text.","You can also edit the transcriptions by clicking on the pencil button above the text."],title:Object(D.jsx)("h2",{style:{margin:0},children:"Transcribing Instructions"}),startButtonContent:Object(D.jsx)("div",{children:"Start Reviewing"})}),Object(D.jsx)(ye,{open:void 0!==Y,header:Object(D.jsx)(Le,{message:Object(D.jsxs)("div",{style:{whiteSpace:"pre"},children:["You Are Editing"," ",Object(D.jsx)("span",{style:{textDecoration:"underline"},children:"".concat(null===Y||void 0===Y?void 0:Y.creatorid)}),"'s Transcription"]})}),exit:function(){_(void 0)},children:Object(D.jsxs)("div",{style:{position:"relative"},children:[Object(D.jsx)(nn.a,{style:{maxHeight:"300px",overflow:"scroll"},children:M.transcriptions.filter((function(e){return e.id!==(null===Y||void 0===Y?void 0:Y.id)})).map((function(e){return Object(D.jsxs)(rn.a,{style:{display:"flex"},children:[Object(D.jsxs)("span",{style:{alignSelf:"flex-start",fontWeight:600,whiteSpace:"pre"},children:[e.creatorid,":"," "]}),Object(D.jsx)("div",{style:{whiteSpace:"pre",overflowWrap:"anywhere"},children:e.content})]})}))}),Object(D.jsx)(Lt,{transcriptionValue:A,onChange:V}),Object(D.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(D.jsxs)(he,{onClick:function(){Y&&H(M,A,Y.creatorid),_(void 0)},style:{margin:"8px",backgroundColor:"#40bf11",position:"relative",bottom:0,right:0},disabled:""===A,children:[Object(D.jsx)(It.a,{}),Object(D.jsx)("span",{style:{marginLeft:"4px",fontSize:"1.05rem"},children:"Complete"})]})})]})}),Object(D.jsx)(b.a,{children:Object(D.jsx)(ie,{playerRef:p,progressState:l,url:"http://".concat(we,":8845/api/watch/getvideo/").concat(n),controller:j})}),Object(D.jsx)(h.a,{children:Object(D.jsx)(Vt,{currentPage:C,onNavigate:S,numberOfPages:y.length,onComplete:t,style:{width:"100%"},contentContainerStyle:{margin:"0 64px 0 64px"},leftColumn:Object(D.jsx)("div",{style:{position:"fixed",bottom:0,left:0,margin:"16px",zIndex:1},children:Object(D.jsx)(he,{onClick:function(){return S("prev")},children:Object(D.jsx)(Bt.a,{})})}),rightColumn:Object(D.jsx)("div",{style:{position:"fixed",bottom:0,right:0,margin:"16px",zIndex:1},children:Object(D.jsx)(he,{onClick:function(){return T?t():S("next")},style:{backgroundColor:T?"green":"#d9534f"},children:T?Object(D.jsx)(d.a,{}):Object(D.jsx)(Pt.a,{})})}),children:Object(D.jsx)(I,{chunk:M,children:M.transcriptions.map((function(e){var t;return e.content&&Object(D.jsxs)(b.a,{className:v.cardContainer,children:[Object(D.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(D.jsxs)("div",{style:{fontSize:"1.2rem",display:"flex",justifyContent:"center",paddingLeft:"10px"},children:[Object(D.jsx)(an.a,{}),Object(D.jsx)("div",{style:{marginLeft:"4px",overflowWrap:"anywhere"},children:e.creatorid})]}),Object(D.jsx)(he,{onClick:function(){return _(e)},style:{padding:"0px",height:"32px",width:"32px",minWidth:"32px"},children:Object(D.jsx)(on.a,{fontSize:"small"})})]}),Object(D.jsxs)("div",{onClick:function(){var t;return F&&((null===(t=M.review)||void 0===t?void 0:t.selectedtranscription)!==e.id?N(M,e,F):R(M))},style:{display:"flex",flexDirection:"row"},children:[Object(D.jsx)(cn.a,{checked:(null===(t=M.review)||void 0===t?void 0:t.selectedtranscription)===e.id,onChange:function(t,n){return F&&(n?N(M,e,F):R(M))},style:{backgroundColor:"initial"}}),Object(D.jsx)(B.a,{variant:"h6",style:{padding:"8px",overflowWrap:"anywhere",whiteSpace:"pre"},children:e.content})]}),Object(D.jsx)(P.a,{style:{margin:"16px 0 16px 0"}})]},e.id)}))})})})]})},un=n(90),dn=[["year",31536e3],["month",2592e3],["day",86400],["hour",3600],["minute",60],["second",1]],jn=function(e){var t=function(e){var t,n=Object(un.a)(dn);try{for(n.s();!(t=n.n()).done;){var r=Object(o.a)(t.value,2),i=r[0],c=r[1],a=Math.floor(e/+c);if(a>=1)return{interval:a,epoch:i}}}catch(s){n.e(s)}finally{n.f()}return{interval:0,epoch:"second"}}(Math.floor((+new Date-+new Date(e))/1e3)),n=t.interval,r=t.epoch,i=1===n?"":"s";return"second"===r?"Less than a minute ago":"".concat(n," ").concat(r).concat(i," ago")},bn=function(e){var t,n,r,i,c=e.contribution,a=c.type,o=c.name,s=c.chunk;return Object(D.jsxs)("span",{style:{display:"flex",flexWrap:"wrap"},children:[Object(D.jsxs)("div",{style:{whiteSpace:"pre"},children:[Object(D.jsx)("span",{style:{fontWeight:"bold"},children:function(e){switch(e){case"chunk":return"Created ";case"transcription":return"Transcribed ";case"review":return"Reviewed "}}(a)}),"the chunk "]}),Object(D.jsxs)("div",{style:{overflowWrap:"anywhere"},children:['"',M(s),'"']})," (","".concat(v(T(S(s.starttimestamp)))," - ").concat(v(T(S(s.endtimestamp)))),")",Object(D.jsx)(B.a,{variant:"subtitle2",style:{marginLeft:"4px",fontWeight:600},children:jn("chunk"===a?s.updatedat:"transcription"===a?null!==(t=null===(n=zt(s,o))||void 0===n?void 0:n.updatedat)&&void 0!==t?t:new Date:null!==(r=null===(i=s.review)||void 0===i?void 0:i.reviewedat)&&void 0!==r?r:new Date)})]})},hn=function(e){var t=e.show,n=e.exit,i=e.chunks,c=Object(r.useMemo)((function(){return Array.from(function(e){return e.map((function(e){return{name:e.creatorid,type:"chunk",chunk:e}})).concat(e.reduce((function(e,t){return e.concat(t.transcriptions.map((function(e){return{name:e.creatorid,type:"transcription",chunk:t}})))}),[])).concat(e.reduce((function(e,t){return t.review?e.concat([{name:t.review.reviewedby,type:"review",chunk:t}]):e}),[]))}(i).reduce((function(e,t){return e.get(t.name)?e.set(t.name,e.get(t.name).concat([t])):e.set(t.name,[t])}),new Map))}),[i]);return Object(D.jsx)(ye,{header:Object(D.jsx)(B.a,{variant:"h3",style:{fontWeight:"lighter"},children:"Contributions"}),open:t,exit:n,children:Object(D.jsx)(me,{children:Object(D.jsx)(h.a,{style:{height:"80vh",width:"90vw",overflow:"scroll"},children:Object(D.jsx)(p.a,{cols:1,cellHeight:"auto",children:c.map((function(e){return Object(D.jsx)(f.a,{children:Object(D.jsx)(F,{title:Object(D.jsx)("div",{style:{overflowWrap:"anywhere"},children:e[0]}),children:Object(D.jsx)(nn.a,{children:e[1].map((function(e){return Object(D.jsx)(rn.a,{children:Object(D.jsx)(bn,{contribution:e})},"".concat(e.chunk.id).concat(e.type))}))})})},e[0])}))})})})})},pn=function(){var e=Object(r.useState)(Mt.Dashboard),t=Object(o.a)(e,2),n=t[0],i=t[1],c=ue.ChunksProvider,a=function(){var e=Object(r.useState)(""),t=Object(o.a)(e,2),n=t[0],i=t[1];return Object(r.useEffect)((function(){console.log(window.location.href.split("/")[4].split("?")[0]),i(window.location.href.split("/")[4].split("?")[0])}),[]),n}(),s=tn(a),l=s.storyTitle,u=Object(o.a)(s.chunksState,2),d=u[0],j=u[1],b=Object(r.useMemo)((function(){return k(d)}),[d]),h=Object(r.useMemo)((function(){return d.length?function(e){return e.reduce((function(e,t){return e+(w(t)?1:0)}),0)}(d)/d.length:0}),[d]),p=Object(r.useMemo)((function(){return d.length?function(e){return e.reduce((function(e,t){return e+(t.review?1:0)}),0)}(d)/d.length:0}),[d]),f=Nt(i,[{progress:100*b,enabled:!0},{progress:100*h,enabled:b>0},{progress:100*p,enabled:h>0}]),O=A(!1),x=Object(o.a)(O,2),g=x[0],m=x[1],v=V("showChunkEditorOnboardingModal","true"),y=Object(o.a)(v,2),C=y[0],S=y[1],T=V("showTranscriberOnboardingModal","true"),M=Object(o.a)(T,2),N=M[0],R=M[1],B=V("showReviewerOnboardingModal","true"),P=Object(o.a)(B,2),F=P[0],W=P[1],I=Object(r.useCallback)((function(){return i(Mt.Dashboard)}),[]),E=Object(r.useMemo)((function(){return[{content:Object(D.jsx)("div",{children:"Show Contributions"}),handler:m}].concat(n===Mt.Chunking?{content:Object(D.jsx)("div",{children:"View instructions"}),handler:function(){S("true")}}:n===Mt.Reviewing?{content:Object(D.jsx)("div",{children:"View instructions"}),handler:function(){W("true")}}:[])}),[n,S,W,m]);return Object(D.jsx)(c,{state:[d,j],children:Object(D.jsx)(U,{children:Object(D.jsxs)("main",{children:[Object(D.jsx)(hn,{chunks:d,show:g,exit:m}),Object(D.jsx)(Tt,{title:Mt[n],hidden:n===Mt.Transcribing,contextMenuItems:E,children:n===Mt.Dashboard?Object(D.jsx)(Ct,{steps:f,storyName:l||"Loading",logOutAction:function(){S("true"),R("true"),W("true")}}):n===Mt.Chunking?Object(D.jsx)(ot,{story_id:a,atExit:I,onboarding:{showOnboardingModal:"true"===C,dismissOnboardingModal:function(){return S("false")}}}):n===Mt.Transcribing?Object(D.jsx)(Gt,{story_id:a,atExit:I,onboarding:{showOnboardingModal:"true"===N,dismissOnboardingModal:function(){return R("false")}}}):n===Mt.Reviewing?Object(D.jsx)(ln,{atExit:I,story_id:a,onboarding:{showOnboardingModal:"true"===F,dismissOnboardingModal:function(){return W("false")}}}):null})]})})})},fn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,238)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),c(e),a(e)}))};a.a.render(Object(D.jsx)(i.a.StrictMode,{children:Object(D.jsx)(pn,{})}),document.getElementById("root")),fn()}},[[154,1,2]]]);
//# sourceMappingURL=main.f8c6a6bd.chunk.js.map